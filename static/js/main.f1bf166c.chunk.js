(this["webpackJsonpnand2tetris-online"]=this["webpackJsonpnand2tetris-online"]||[]).push([[0],{23:function(t,e,n){},24:function(t,e,n){},27:function(t,e,n){"use strict";n.r(e);var i,a=n(5),s=n.n(a),r=n(17),u=n.n(r),c=(n(23),n(24),n(7)),o=n(0),l=n(1);!function(t){t.INPUT="INPUT",t.OUTPUT="OUTPUT",t.INTERNAL="INTERNAL",t.UNKNOWN="UNKNOWN"}(i||(i={}));var h=function(){function t(e,n,a){Object(o.a)(this,t),this.namesToTypes=void 0,this.namesToNumbers=void 0,this.name=void 0,this.inputPinsInfo=void 0,this.outputPinsInfo=void 0,this.isClocked=void 0,this.isInputClocked=void 0,this.isOutputClocked=void 0,this.name=e,this.namesToTypes={},this.namesToNumbers={},this.inputPinsInfo=n,this.registerPins(n,i.INPUT),this.outputPinsInfo=a,this.registerPins(a,i.OUTPUT),this.isClocked=!1,this.isInputClocked=[],this.isOutputClocked=[]}return Object(l.a)(t,[{key:"getPinInfo",value:function(t,e){switch(t){case i.INPUT:if(e<this.inputPinsInfo.length)return this.inputPinsInfo[e];break;case i.OUTPUT:if(e<this.outputPinsInfo.length)return this.outputPinsInfo[e]}return null}},{key:"getPinType",value:function(t){var e;return null!==(e=this.namesToTypes[t])&&void 0!==e?e:i.UNKNOWN}},{key:"getPinNumber",value:function(t){var e;return null!==(e=this.namesToNumbers[t])&&void 0!==e?e:-1}},{key:"registerPins",value:function(t,e){var n=this;t.forEach((function(t,i){n.registerPin(t,e,i)}))}},{key:"registerPin",value:function(t,e,n){this.namesToTypes[t.name]=e,this.namesToNumbers[t.name]=n}}]),t}(),d=n(15),p=n.n(d),v=n(18),f=n(4);function O(t){var e,n,i=t.hdlFilename,s=t.setHDLFileName,r=t.userWorkspace,u=t.setUserWorkspace,c=t.testScript,o=t.setTestScript,l=t.singleStep,h=t.setFormat,d=Object(a.useCallback)(function(){var t=Object(v.a)(p.a.mark((function t(e){var n,i,a,r,c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.target.files){t.next=3;break}throw new Error("no files found");case 3:i=new Map,r=0;case 5:if(!(r<n.length)){t.next=17;break}return(c=n[r]).name.endsWith(".hdl")&&!a&&(a=c),t.t0=i,t.t1=c.name,t.next=12,c.text();case 12:t.t2=t.sent,t.t0.set.call(t.t0,t.t1,t.t2);case 14:r++,t.next=5;break;case 17:u(i),a&&s(a.name);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[s,u]),O=Array.from(null!==(e=null===r||void 0===r?void 0:r.keys())&&void 0!==e?e:[]).filter((function(t){return t.endsWith(".tst")})),k=Array.from(null!==(n=null===r||void 0===r?void 0:r.keys())&&void 0!==n?n:[]).filter((function(t){return t.endsWith(".hdl")}));return Object(f.jsxs)("div",{className:"actions",children:[Object(f.jsx)("input",{type:"file",webkitdirectory:"",directory:"",mozdirectory:"",onChange:d}),Object(f.jsx)("select",{value:null!==i&&void 0!==i?i:void 0,onChange:function(t){return s(t.target.value)},children:k.map((function(t){return Object(f.jsx)("option",{value:t,children:t},t)}))}),Object(f.jsx)("select",{value:null!==c&&void 0!==c?c:void 0,onChange:function(t){return o(t.target.value)},children:O.map((function(t){return Object(f.jsx)("option",{value:t,children:t},t)}))}),Object(f.jsxs)("select",{onChange:function(t){return h(t.target.value)},children:[Object(f.jsx)("option",{value:"decimal",children:"Decimal"},"decimal"),Object(f.jsx)("option",{value:"binary",children:"Binary"},"binary"),Object(f.jsx)("option",{value:"hexadecimal",children:"Hexadecimal"},"hexadecimal")]}),Object(f.jsx)("button",{onClick:l,children:"Single Step"})]})}function k(t){var e=t.hdl;return Object(f.jsx)("div",{className:"hdlViewer",children:Object(f.jsx)("pre",{children:e})})}function b(t){var e=t.title,n=t.type,s=t.pinData,r=t.updatePin,u=t.format,c=Object(a.useCallback)((function(t,e,n){r({value:t,number:e,type:n})}),[r]);return Object(f.jsxs)("div",{className:"pins",children:[Object(f.jsx)("h3",{children:e}),Object(f.jsx)("table",{children:Object(f.jsx)("tbody",{children:s.map((function(t,e){var a=t.name,s=t.value,r=n===i.INPUT?s:function(t,e){var n,i=null!==(n=parseInt(t))&&void 0!==n?n:0;switch(e){case"binary":return i.toString(2);case"hexadecimal":return i.toString(16);default:return i.toString()}}(s,u);return Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{children:a}),Object(f.jsx)("td",{children:Object(f.jsx)("input",{value:r,onChange:function(t){return c(t.target.value,e,n)}})})]},e)}))})})]})}function I(t){var e=t.status;return Object(f.jsx)("div",{className:"statusMessage",children:e})}var P,g=n(16),T=n(2),N=n(3),C=n(12);!function(t){t.IDENTIFIER="IDENTIFIER",t.TRUE="true",t.FALSE="false",t.CHIP="CHIP",t.IN="IN",t.OUT="OUT",t.PARTS="PARTS",t.BUILTIN="BUILTIN",t.CLOCKED="CLOCKED",t.INT="INT",t.LBRACE="LBRACE",t.RBRACE="RBRACE",t.LBRACKET="LBRACKET",t.RBRACKET="RBRACKET",t.LPAREN="LPAREN",t.RPAREN="RPAREN",t.COLON="COLON",t.EQUAL="EQUAL",t.COMMA="COMMA",t.SEMICOLON="SEMICOLON",t.DOT="DOT",t.INVALID="INVALID",t.EOF="EOF"}(P||(P={}));var m=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return n}(Object(C.a)(Error)),y=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.readpos=void 0,this.pos=void 0,this.cur=void 0,this.keywords=void 0,this.token={type:null,literal:null},this.input=e,this.readpos=0,this.pos=0,this.cur="",this.keywords={CHIP:P.CHIP,IN:P.IN,OUT:P.OUT,PARTS:P.PARTS,BUILTIN:P.BUILTIN,CLOCKED:P.CLOCKED,true:P.TRUE,false:P.FALSE},this.readChar()}return Object(l.a)(t,[{key:"hasMoreTokens",value:function(){return this.token.type!==P.EOF}},{key:"advance",value:function(){switch(this.skipWhitespaceAndComments(),this.token.literal=this.cur,this.cur){case"{":this.token.type=P.LBRACE;break;case"}":this.token.type=P.RBRACE;break;case"(":this.token.type=P.LPAREN;break;case")":this.token.type=P.RPAREN;break;case"[":this.token.type=P.LBRACKET;break;case"]":this.token.type=P.RBRACKET;break;case"=":this.token.type=P.EQUAL;break;case",":this.token.type=P.COMMA;break;case".":this.token.type=P.DOT;break;case":":this.token.type=P.COLON;break;case";":this.token.type=P.SEMICOLON;break;case"":this.token.type=P.EOF;break;default:if(j(this.cur)){var t=this.readIdentifier();return this.token.type=this.lookupIdentifier(t),void(this.token.literal=t)}if(A(this.cur))return this.token.type=P.INT,void(this.token.literal=this.readNumber())}this.readChar()}},{key:"fail",value:function(e){t.fail(e)}},{key:"lookupIdentifier",value:function(t){var e;return null!==(e=this.keywords[t])&&void 0!==e?e:P.IDENTIFIER}},{key:"readIdentifier",value:function(){for(var t=this.pos;j(this.cur)||A(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readNumber",value:function(){for(var t=this.pos;A(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readChar",value:function(){this.cur=this.readpos>=this.input.length?"":this.input[this.readpos],this.pos=this.readpos,this.readpos++}},{key:"peekChar",value:function(){return this.readpos>=this.input.length?"":this.input[this.readpos]}},{key:"skipWhitespaceAndComments",value:function(){for(var t=!1,e=!1;;){var n=this.peekChar();if("/"===this.cur&&"/"===n)t=!0,this.readChar();else if(t&&"\n"===this.cur)t=!1;else if("/"===this.cur&&"*"===n)e=!0,this.readChar();else if(e&&"*"===this.cur&&"/"===n)e=!1,this.readChar();else if(!t&&!e&&" "!==this.cur&&"\t"!==this.cur&&"\n"!==this.cur&&"\r"!==this.cur)return;this.readChar()}}}],[{key:"fail",value:function(t){throw new m(t)}}]),t}();function j(t){var e=t.charCodeAt(0);return e>=65&&e<91||e>=97&&e<123}function A(t){var e=t.charCodeAt(0);return e>=48&&e<58}var U=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.token={literal:null,type:null},this.peek={literal:null,type:null},this.input=e,this.advance(),this.advance()}return Object(l.a)(t,[{key:"advance",value:function(){this.token=Object(g.a)({},this.peek),this.input.advance(),this.peek=Object(g.a)({},this.input.token)}},{key:"hasMoreTokens",value:function(){return!this.tokenIs(P.EOF)}},{key:"tokenIs",value:function(t){return this.token.type===t}},{key:"peekTokenIs",value:function(t){return this.peek.type===t}},{key:"expectCurrent",value:function(t,e){this.tokenIs(t)||this.fail(e)}},{key:"expectPeek",value:function(t,e){this.peekTokenIs(t)?this.advance():this.fail(e)}},{key:"expectPeekOneOf",value:function(t,e){this.peek.type&&t.includes(this.peek.type)?this.advance():this.fail(e)}},{key:"fail",value:function(t){this.input.fail(t)}}],[{key:"fail",value:function(t){y.fail(t)}}]),t}(),E=function(){function t(e,n,i){Object(o.a)(this,t),this.gateClass=void 0,this.inputPins=void 0,this.outputPins=void 0,this.inputPins=e,this.outputPins=n,this.gateClass=i}return Object(l.a)(t,[{key:"getNode",value:function(t){var e=this.gateClass.getPinType(t),n=this.gateClass.getPinNumber(t);switch(e){case i.INPUT:return this.inputPins[n];case i.OUTPUT:return this.outputPins[n]}return null}},{key:"tick",value:function(){console.log("Gate tick()"),this.doEval(),this.clockUp()}},{key:"tock",value:function(){console.log("Gate tock()"),this.clockDown(),this.doEval()}},{key:"eval",value:function(){this.doEval()}},{key:"doEval",value:function(){this.reCompute()}}]),t}(),M=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){}},{key:"clockUp",value:function(){}},{key:"clockDown",value:function(){}}]),n}(E),R=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(1-t)}}]),n}(M),L=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(~t)}}]),n}(M),x=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t&e)}}]),n}(M),w=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t^e)}}]),n}(M),S={Not:R,Not16:L,And:x,Or:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t|e)}}]),n}(M),Xor:w,Mux:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get();this.outputPins[0].set(0===n?t:e)}}]),n}(M),Mux4Way16:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get(),i=this.inputPins[3].get(),a=0;switch(this.inputPins[4].get()){case 0:a=t;break;case 1:a=e;break;case 2:a=n;break;case 3:a=i}this.outputPins[0].set(a)}}]),n}(M),Mux8Way16:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get(),i=this.inputPins[3].get(),a=this.inputPins[4].get(),s=this.inputPins[5].get(),r=this.inputPins[6].get(),u=this.inputPins[7].get(),c=0;switch(this.inputPins[8].get()){case 0:c=t;break;case 1:c=e;break;case 2:c=n;break;case 3:c=i;break;case 4:c=a;break;case 5:c=s;break;case 6:c=r;break;case 7:c=u}this.outputPins[0].set(c)}}]),n}(M),DMux:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(0===e?0:t)}}]),n}(M),DMux4Way:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(1===e?t:0),this.outputPins[2].set(2===e?t:0),this.outputPins[3].set(3===e?t:0)}}]),n}(M),DMux8Way:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(1===e?t:0),this.outputPins[2].set(2===e?t:0),this.outputPins[3].set(3===e?t:0),this.outputPins[4].set(4===e?t:0),this.outputPins[5].set(5===e?t:0),this.outputPins[6].set(6===e?t:0),this.outputPins[7].set(7===e?t:0)}}]),n}(M),Or8Way:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(0===t?0:1)}}]),n}(M)},D={HalfAdder:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t^e),this.outputPins[1].set(t&e)}}]),n}(M),FullAdder:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get()+this.inputPins[1].get()+this.inputPins[2].get();this.outputPins[0].set(t%2),this.outputPins[1].set(t/2)}}]),n}(M),Add16:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t+e)}}]),n}(M),Inc16:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(t+1)}}]),n}(M),ALU:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.inputPins[2].get()&&(t=0),this.inputPins[3].get()&&(t=~t),this.inputPins[4].get()&&(e=0),this.inputPins[5].get()&&(e=~e);var n=1===this.inputPins[6].get()?t+e:t&e;this.inputPins[7].get()&&(n=~n),this.outputPins[0].set(n),this.outputPins[1].set(0===n?1:0),this.outputPins[2].set(n<0?1:0)}}]),n}(M)},F=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).state=void 0,s.state=0,s}return Object(l.a)(n,[{key:"clockUp",value:function(){1===this.inputPins[1].get()&&(this.state=this.inputPins[0].get())}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),n}(M),B=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).state=void 0,s.state=0,s}return Object(l.a)(n,[{key:"clockUp",value:function(){1===this.inputPins[1].get()&&(this.state=this.inputPins[0].get())}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),n}(M),K=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).value=void 0,s.value=0,s}return Object(l.a)(n,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get();1===this.inputPins[3].get()?this.value=0:1===e?this.value=t:1===n&&this.value++}},{key:"clockDown",value:function(){this.outputPins[0].set(this.value)}}]),n}(M),W=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a,s){var r;return Object(o.a)(this,n),(r=e.call(this,t,i,a)).size=void 0,r.values=void 0,r.size=s,r.values=new Uint16Array(s),r}return Object(l.a)(n,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get();1===e&&(this.values[n]=t)}},{key:"clockDown",value:function(){this.reCompute()}},{key:"reCompute",value:function(){var t=this.inputPins[2].get();this.outputPins[0].set(this.values[t])}}]),n}(M),_={Bit:F,Register:B,PC:K,RAM:W,RAM8:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){return Object(o.a)(this,n),e.call(this,t,i,a,8)}return n}(W),RAM64:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){return Object(o.a)(this,n),e.call(this,t,i,a,64)}return n}(W),RAM512:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){return Object(o.a)(this,n),e.call(this,t,i,a,512)}return n}(W),RAM4K:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){return Object(o.a)(this,n),e.call(this,t,i,a,4096)}return n}(W),RAM16K:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){return Object(o.a)(this,n),e.call(this,t,i,a,16384)}return n}(W)},H=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).values=void 0,s.values=new Uint16Array(8192),s}return Object(l.a)(n,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),n=this.inputPins[2].get();1===e&&(this.values[n]=t)}},{key:"reCompute",value:function(){var t=this.inputPins[2].get();this.outputPins[0].set(this.values[t])}},{key:"clockDown",value:function(){this.reCompute()}}]),n}(M),G=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).key=void 0,s.key=-1,s}return n}(M),V=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).values=void 0,s.values=new Uint16Array(n.SIZE),s}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(this.values[t])}}]),n}(M);V.SIZE=32768;var X={Screen:H,Keyboard:G,ROM32K:V},z={Nand:{hdl:"CHIP Nand { IN  a, b; OUT out; BUILTIN Nand; }",gate:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(1-(t&e))}}]),n}(M)},DFF:{hdl:"CHIP DFF { IN  in; OUT out; BUILTIN DFF; CLOCKED in; }",gate:function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a){var s;return Object(o.a)(this,n),(s=e.call(this,t,i,a)).state=void 0,s.state=0,s}return Object(l.a)(n,[{key:"clockUp",value:function(){this.state=this.inputPins[0].get()}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),n}(M)},Not:{hdl:"CHIP Not { IN  in; OUT out; BUILTIN Not; } ",gate:S.Not},Not16:{hdl:"CHIP Not16 { IN  in[16]; OUT out[16]; BUILTIN Not16; }",gate:S.Not16},And:{hdl:"CHIP And { IN  a, b; OUT out; BUILTIN And; } ",gate:S.And},And16:{hdl:"CHIP And16 { IN  a[16], b[16]; OUT out[16]; BUILTIN And; }",gate:S.And},Or:{hdl:"CHIP Or { IN  a, b; OUT out; BUILTIN Or; }",gate:S.Or},Or16:{hdl:"CHIP Or16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Or; }",gate:S.Or},Xor:{hdl:"CHIP Xor { IN  a, b; OUT out; BUILTIN Xor; }",gate:S.Xor},Mux:{hdl:"CHIP Mux { IN  a, b, sel; OUT out; BUILTIN Mux;}",gate:S.Mux},Mux16:{hdl:"CHIP Mux16 { IN  a[16], b[16], sel; OUT out[16]; BUILTIN Mux; }",gate:S.Mux},Mux4Way16:{hdl:" CHIP Mux4Way16 { IN a[16], b[16], c[16], d[16], sel[2]; OUT out[16]; BUILTIN Mux4Way16; }",gate:S.Mux4Way16},Mux8Way16:{hdl:"CHIP Mux8Way16 { IN  a[16], b[16], c[16], d[16], e[16], f[16], g[16], h[16], sel[3]; OUT out[16]; BUILTIN Mux8Way16; }",gate:S.Mux8Way16},DMux:{hdl:"CHIP DMux { IN  in, sel; OUT a, b; BUILTIN DMux; }",gate:S.DMux},DMux4Way:{hdl:"CHIP DMux4Way { IN  in, sel[2]; OUT a, b, c, d; BUILTIN DMux4Way; }",gate:S.DMux4Way},DMux8Way:{hdl:"CHIP DMux8Way { IN  in, sel[3]; OUT a, b, c, d, e, f, g, h; BUILTIN DMux8Way; }",gate:S.DMux8Way},Or8Way:{hdl:"CHIP Or8Way { IN  in[8]; OUT out; BUILTIN Or8Way; }",gate:S.Or8Way},HalfAdder:{hdl:"CHIP HalfAdder { IN  a, b; OUT sum, carry; BUILTIN HalfAdder; }",gate:D.HalfAdder},FullAdder:{hdl:"CHIP FullAdder { IN  a, b, c; OUT sum, carry; BUILTIN FullAdder; }",gate:D.FullAdder},Add16:{hdl:"CHIP Add16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Add16; }",gate:D.Add16},Inc16:{hdl:"CHIP Inc16 { IN  in[16]; OUT out[16]; BUILTIN Inc16; }",gate:D.Inc16},ALU:{hdl:"CHIP ALU { IN x[16], y[16], zx, nx, zy, ny, f, no; OUT out[16], zr, ng; BUILTIN ALU; }",gate:D.ALU},Bit:{hdl:"CHIP Bit { IN  in, load; OUT out; BUILTIN Bit; CLOCKED in, load; }",gate:_.Bit},Register:{hdl:"CHIP Register { IN  in[16], load; OUT out[16]; BUILTIN Register; CLOCKED in, load; }",gate:_.Register},PC:{hdl:"CHIP PC { IN  in[16], load, inc, reset; OUT out[16]; BUILTIN PC; CLOCKED in, load, inc, reset; }",gate:_.PC},RAM8:{hdl:"CHIP RAM8 { IN  in[16], load, address[3]; OUT out[16]; BUILTIN RAM8; CLOCKED in, load; }",gate:_.RAM8},RAM64:{hdl:"CHIP RAM64 { IN in[16], load, address[6]; OUT out[16]; BUILTIN RAM64; CLOCKED in, load; }",gate:_.RAM64},RAM512:{hdl:"CHIP RAM512 { IN  in[16], load, address[9]; OUT out[16]; BUILTIN RAM512; CLOCKED in, load; }",gate:_.RAM512},RAM4K:{hdl:"CHIP RAM4K { IN  in[16], load, address[12]; OUT out[16]; BUILTIN RAM4K; CLOCKED in, load; }",gate:_.RAM4K},RAM16K:{hdl:"CHIP RAM16K { IN  in[16], load, address[14]; OUT out[16]; BUILTIN RAM16K; CLOCKED in, load; }",gate:_.RAM16K},Screen:{hdl:"CHIP Screen { IN in[16], load, address[13]; OUT out[16]; BUILTIN Screen; CLOCKED in, load; }",gate:X.Screen},Keyboard:{hdl:"CHIP Keyboard { OUT out[16]; BUILTIN Keyboard; }",gate:X.Keyboard},ROM32K:{hdl:"CHIP ROM32K { IN  address[15]; OUT out[16]; BUILTIN ROM32K; }",gate:X.ROM32K}},Q=n(10),J=n(6),Z=n(8);var q=function(){function t(){Object(o.a)(this,t),this.value=void 0,this.connections=null,this.value=new Uint16Array(1)}return Object(l.a)(t,[{key:"get",value:function(){return this.value[0]}},{key:"set",value:function(t){var e;if(t!==this.value[0]){this.value[0]=t;var n,i=Object(Z.a)(null!==(e=this.connections)&&void 0!==e?e:[]);try{for(i.s();!(n=i.n()).done;){n.value.set(this.get())}}catch(a){i.e(a)}finally{i.f()}}}},{key:"connect",value:function(t){this.connections||(this.connections=new Set),this.connections.add(t)}},{key:"disconnect",value:function(t){this.connections&&this.connections.delete(t)}}]),t}(),Y=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t){var i,a=Object(c.a)(t,2),s=a[0],r=a[1];return Object(o.a)(this,n),(i=e.call(this)).mask=void 0,i.shiftRight=void 0,i.mask=et(s,r),i.shiftRight=s,i}return Object(l.a)(n,[{key:"set",value:function(t){Object(Q.a)(Object(J.a)(n.prototype),"set",this).call(this,t)}},{key:"get",value:function(){return(this.value[0]&this.mask)>>>this.shiftRight}}]),n}(q),$=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i){var a,s=Object(c.a)(i,2),r=s[0],u=s[1];return Object(o.a)(this,n),(a=e.call(this)).target=void 0,a.mask=void 0,a.shiftLeft=void 0,a.target=t,a.shiftLeft=r,a.mask=et(r,u),a}return Object(l.a)(n,[{key:"get",value:function(){return this.target.get()}},{key:"set",value:function(t){var e=this.target.get()&~this.mask,n=t<<this.shiftLeft&this.mask;this.target.set(e|n)}}]),n}(q),tt=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768];function et(t,e){for(var n=0,i=tt[t],a=t;a<=e;a++)n|=i,i<<=1;return n}var nt,it=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a,s){var r;switch(Object(o.a)(this,n),(r=e.call(this,t,a,s)).tsClassName=void 0,i.expectPeek(P.IDENTIFIER,"Missing typescript class name"),t){case"Nand":r.tsClassName=z.Nand.gate;break;case"Not":r.tsClassName=z.Not.gate;break;case"Not16":r.tsClassName=z.Not16.gate;break;case"And":r.tsClassName=z.And.gate;break;case"And16":r.tsClassName=z.And16.gate;break;case"Or":r.tsClassName=z.Or.gate;break;case"Or16":r.tsClassName=z.Or16.gate;break;case"Xor":r.tsClassName=z.Xor.gate;break;case"Mux":r.tsClassName=z.Mux.gate;break;case"Mux16":r.tsClassName=z.Mux16.gate;break;case"Mux4Way16":r.tsClassName=z.Mux4Way16.gate;break;case"Mux8Way16":r.tsClassName=z.Mux8Way16.gate;break;case"DMux":r.tsClassName=z.DMux.gate;break;case"DMux4Way":r.tsClassName=z.DMux4Way.gate;break;case"DMux8Way":r.tsClassName=z.DMux8Way.gate;break;case"Or8Way":r.tsClassName=z.Or8Way.gate;break;case"HalfAdder":r.tsClassName=z.HalfAdder.gate;break;case"FullAdder":r.tsClassName=z.FullAdder.gate;break;case"Add16":r.tsClassName=z.Add16.gate;break;case"Inc16":r.tsClassName=z.Inc16.gate;break;case"ALU":r.tsClassName=z.ALU.gate;break;case"DFF":r.tsClassName=z.DFF.gate;break;case"Bit":r.tsClassName=z.Bit.gate;break;case"Register":r.tsClassName=z.Register.gate;break;case"PC":r.tsClassName=z.PC.gate;break;case"RAM8":r.tsClassName=z.RAM8.gate;break;case"RAM64":r.tsClassName=z.RAM64.gate;break;case"RAM512":r.tsClassName=z.RAM512.gate;break;case"RAM4K":r.tsClassName=z.RAM4K.gate;break;case"RAM16K":r.tsClassName=z.RAM16K.gate;break;case"Screen":r.tsClassName=z.Screen.gate;break;case"Keyboard":r.tsClassName=z.Keyboard.gate;break;case"ROM32K":r.tsClassName=z.ROM32K.gate;break;default:i.fail("Unexpected gate class name ".concat(t))}if(i.expectPeek(P.SEMICOLON,"Missing ';'"),r.isInputClocked=new Array(a.length),r.isOutputClocked=new Array(s.length),i.peekTokenIs(P.CLOCKED)){r.isClocked=!0;for(var u=ct(i),c=0;c<u.length;c++){for(var l=!1,h=!1,d=0;d<r.isInputClocked.length&&!l;d++)r.isInputClocked[d]||(l=a[d].name===u[c].name,r.isInputClocked[d]=l);if(!l)for(var p=0;p<r.isOutputClocked.length&&!h;p++)r.isOutputClocked[p]||(h=s[p].name===u[p].name,r.isOutputClocked[p]=h)}}return i.expectPeek(P.RBRACE,"Missing '}'"),r}return Object(l.a)(n,[{key:"newInstance",value:function(){var t=this.inputPinsInfo.map((function(t){return new q})),e=this.outputPinsInfo.map((function(t){return new q}));return new this.tsClassName(t,e,this)}}]),n}(h);!function(t){t.FROM_INPUT="FROM_INPUT",t.TO_OUTPUT="TO_OUTPUT",t.FROM_INTERNAL="FROM_INTERNAL",t.TO_INTERNAL="TO_INTERNAL",t.FROM_TRUE="FROM_TRUE",t.FROM_FALSE="FROM_FALSE",t.INVALID="INVALID"}(nt||(nt={}));var at=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a,s,r){var u;return Object(o.a)(this,n),(u=e.call(this,t,i,s)).parts=void 0,u.internalPins=void 0,u.internalPins=a,u.parts=r,u}return Object(l.a)(n,[{key:"reCompute",value:function(){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.eval()}}catch(n){e.e(n)}finally{e.f()}}},{key:"clockUp",value:function(){if(this.gateClass.isClocked){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.tick()}}catch(n){e.e(n)}finally{e.f()}}}},{key:"clockDown",value:function(){if(this.gateClass.isClocked){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.tock()}}catch(n){e.e(n)}finally{e.f()}}}},{key:"getNode",value:function(t){var e=Object(Q.a)(Object(J.a)(n.prototype),"getNode",this).call(this,t);if(!e){var a=this.gateClass.getPinType(t),s=this.gateClass.getPinNumber(t);if(a===i.INTERNAL)return this.internalPins[s]}return e}}]),n}(E),st=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(t,i,a,s,r){var u;return Object(o.a)(this,n),(u=e.call(this,t,a,s)).partsList=void 0,u.internalPinsInfo=void 0,u.connections=void 0,u.partsList=[],u.internalPinsInfo=[],u.connections=new Set,u.readParts(i,r),u}return Object(l.a)(n,[{key:"newInstance",value:function(){var t,e,n=this.partsList.map((function(t){return t.newInstance()})),i=this.inputPinsInfo.map((function(t){return new q})),a=this.outputPinsInfo.map((function(t){return new q})),s=this.internalPinsInfo.map((function(t){return new q})),r=new Set,u=null,c=null,o=null,l=Object(Z.a)(this.connections);try{for(l.s();!(t=l.n()).done;){var h=t.value;if(u=n[h.partNumber].getNode(h.partPinName))switch(c=h.gateSubBus,o=h.partSubBus,h.type){case nt.FROM_INPUT:this.connectGateToPart(i[h.gatePinNumber],c,u,o);break;case nt.TO_OUTPUT:this.connectGateToPart(u,o,a[h.gatePinNumber],c);break;case nt.TO_INTERNAL:var d=null===o?new q:new Y(o);u.connect(d),s[h.gatePinNumber]=d;break;case nt.FROM_INTERNAL:case nt.FROM_TRUE:case nt.FROM_FALSE:r.add(h)}}}catch(b){l.e(b)}finally{l.f()}var p,v=Object(Z.a)(r);try{for(v.s();!(p=v.n()).done;){var f=p.value;if(u=n[f.partNumber].getNode(f.partPinName))switch(c=f.gateSubBus,o=f.partSubBus,f.type){case nt.FROM_INTERNAL:var O=s[f.gatePinNumber];if(o){var k=new $(u,o);O.connect(k)}else O.connect(u);break;case nt.FROM_TRUE:if(c||U.fail("gateSubBus is null"),(e=new Y(c)).set(1),o)new $(u,o).set(e.get());else u.set(e.get());break;case nt.FROM_FALSE:if(c||U.fail("gateSubBus is null"),(e=new Y(c)).set(0),o)new $(u,o).set(e.get());else u.set(e.get())}}}catch(b){v.e(b)}finally{v.f()}return new at(i,a,s,this,n)}},{key:"connectGateToPart",value:function(t,e,n,i){var a=n;if(i&&(a=new $(a,i)),e){var s=new Y(e);t.connect(s),s.connect(a)}else t.connect(a)}},{key:"readParts",value:function(t,e){for(var n=!1;t.hasMoreTokens()&&!n;)if(t.peekTokenIs(P.RBRACE))t.advance(),n=!0;else{var i;t.expectPeek(P.IDENTIFIER,"A GateClass name is expected");var a=null!==(i=t.token.literal)&&void 0!==i?i:"",s=rt(a,e),r=this.partsList.length;this.partsList.push(s),this.isClocked=this.isClocked||s.isClocked,t.expectPeek(P.LPAREN,"Missing '('"),this.readPinNames(t,a,r),t.expectPeek(P.SEMICOLON,"Missing ';'")}n||t.fail("Missing '}'"),t.expectPeek(P.EOF,"Expected EOF after '}'")}},{key:"readSubBus",value:function(t){var e;t.expectPeek(P.INT,"Missing bus");var n,i=parseInt(null!==(e=t.token.literal)&&void 0!==e?e:""),a=i;t.peekTokenIs(P.DOT)&&(t.advance(),t.expectPeek(P.DOT,"Expected '..'"),t.expectPeek(P.INT,"Expected high sub bus"),a=parseInt(null!==(n=t.token.literal)&&void 0!==n?n:""));return[i,a]}},{key:"readPinNames",value:function(t,e,n){for(var i=!1;t.hasMoreTokens()&&!i;){var a,s;t.expectPeek(P.IDENTIFIER,"A pin name is expected");var r=null!==(a=t.token.literal)&&void 0!==a?a:"",u=null;t.peekTokenIs(P.LBRACKET)&&(t.advance(),u=this.readSubBus(t),t.expectPeek(P.RBRACKET,"Missing ']'")),t.expectPeek(P.EQUAL,"Missing '='");var c=[P.IDENTIFIER,P.TRUE,P.FALSE];t.expectPeekOneOf(c,"A pin name, true, or false is expected");var o=null!==(s=t.token.literal)&&void 0!==s?s:"",l=null;t.peekTokenIs(P.LBRACKET)&&(t.advance(),l=this.readSubBus(t),t.expectPeek(P.RBRACKET,"Missing ']'")),this.addConnection(t,e,n,r,o,l,u),t.peekTokenIs(P.RPAREN)?i=!0:t.peekTokenIs(P.COMMA)||t.fail("Missing ',' or ')'"),t.advance()}i||t.fail("Unexpected EOF")}},{key:"getPinInfo",value:function(t,e){return t===i.INTERNAL&&e<this.internalPinsInfo.length?this.internalPinsInfo[e]:Object(Q.a)(Object(J.a)(n.prototype),"getPinInfo",this).call(this,t,e)}},{key:"addConnection",value:function(t,e,n,a,s,r,u){var c,o,l,h=this.partsList[n],d=h.getPinType(a);d===i.UNKNOWN&&t.fail("".concat(a," is not a pin in ").concat(e));var p,v=h.getPinNumber(a),f=h.getPinInfo(d,v),O=null!==(c=u?u[1]-u[0]+1:null===f||void 0===f?void 0:f.width)&&void 0!==c?c:0,k=i.UNKNOWN,b=0,I=!1,g=nt.INVALID;s===P.TRUE||s===P.FALSE?(p={name:s,width:16},g=nt.FROM_TRUE,I=!0):(k=this.getPinType(s))===i.UNKNOWN?(k=i.INTERNAL,p={name:s,width:O},b=this.internalPinsInfo.length,this.internalPinsInfo.push(p),this.registerPin(p,i.INTERNAL,b)):(b=this.getPinNumber(s),p=this.getPinInfo(k,b));var T=null!==(o=r?r[1]-r[0]+1:null===(l=p)||void 0===l?void 0:l.width)&&void 0!==o?o:1;switch(I&&(r=[0,(T=O)-1]),O!==T&&t.fail("".concat(a,"(").concat(O,") and ").concat(s,"(").concat(T,") have different bus widths")),d){case i.INPUT:switch(k){case i.INPUT:g=nt.FROM_INPUT;break;case i.INTERNAL:g=nt.FROM_INTERNAL;break;case i.OUTPUT:t.fail("Can't connect gate's output pin to part")}break;case i.OUTPUT:switch(k){case i.OUTPUT:g=nt.TO_OUTPUT;break;case i.INTERNAL:g=nt.TO_INTERNAL;break;case i.INPUT:t.fail("Can't connect part's output pin to gate's input pin")}}this.connections.add({type:g,gatePinNumber:b,partNumber:n,partPinName:a,gateSubBus:r,partSubBus:u})}}]),n}(h);function rt(t,e){var n,i="".concat(t,".hdl");return e.has(i)?ut(null!==(n=e.get(i))&&void 0!==n?n:"",e):function(t,e){var n;switch(t){case"Nand":n=z.Nand.hdl;break;case"Not":n=z.Not.hdl;break;case"Not16":n=z.Not16.hdl;break;case"And":n=z.And.hdl;break;case"And16":n=z.And16.hdl;break;case"Or":n=z.Or.hdl;break;case"Or16":n=z.Or16.hdl;break;case"Xor":n=z.Xor.hdl;break;case"Mux":n=z.Mux.hdl;break;case"Mux16":n=z.Mux16.hdl;break;case"Mux4Way16":n=z.Mux4Way16.hdl;break;case"Mux8Way16":n=z.Mux8Way16.hdl;break;case"DMux":n=z.DMux.hdl;break;case"DMux4Way":n=z.DMux4Way.hdl;break;case"DMux8Way":n=z.DMux8Way.hdl;break;case"Or8Way":n=z.Or8Way.hdl;break;case"HalfAdder":n=z.HalfAdder.hdl;break;case"FullAdder":n=z.FullAdder.hdl;break;case"Add16":n=z.Add16.hdl;break;case"Inc16":n=z.Inc16.hdl;break;case"ALU":n=z.ALU.hdl;break;case"DFF":n=z.DFF.hdl;break;case"Bit":n=z.Bit.hdl;break;case"Register":n=z.Register.hdl;break;case"PC":n=z.PC.hdl;break;case"RAM8":n=z.RAM8.hdl;break;case"RAM64":n=z.RAM64.hdl;break;case"RAM512":n=z.RAM512.hdl;break;case"RAM4K":n=z.RAM4K.hdl;break;case"RAM16K":n=z.RAM16K.hdl;break;case"Screen":n=z.Screen.hdl;break;case"Keyboard":n=z.Keyboard.hdl;break;case"ROM32K":n=z.ROM32K.hdl;break;default:U.fail("Invalid builtin gate class name: ".concat(t))}return ut(n,e)}(t,e)}function ut(t,e){var n=new y(t);return function(t,e){var n;t.expectCurrent(P.CHIP,"Missing 'CHIP' keyword"),t.expectPeek(P.IDENTIFIER,"Missing chip name");var i=null!==(n=t.token.literal)&&void 0!==n?n:"";t.expectPeek(P.LBRACE,"Missing '{'");var a=t.peekTokenIs(P.IN)?ct(t):[],s=t.peekTokenIs(P.OUT)?ct(t):[];return t.advance(),t.tokenIs(P.BUILTIN)?new it(i,t,a,s):t.tokenIs(P.PARTS)?(t.expectPeek(P.COLON,"Missing ':'"),new st(i,t,a,s,e)):t.fail("'PARTS' or 'BUILTIN' keyword expected")}(new U(n),e)}function ct(t){var e=[],n=!1;for(t.advance();t.hasMoreTokens()&&!n;)if(t.tokenIs(P.SEMICOLON))n=!0;else{var i;t.expectPeek(P.IDENTIFIER,"Missing pin name, found ".concat(t.peek.literal));var a,s=null!==(i=t.token.literal)&&void 0!==i?i:"",r=1;if(t.peekTokenIs(P.LBRACKET))t.advance(),t.expectPeek(P.INT,"Missing width"),r=parseInt(null!==(a=t.token.literal)&&void 0!==a?a:""),t.expectPeek(P.RBRACKET,"Missing ']'");e.push({name:s,width:r}),t.expectPeekOneOf([P.COMMA,P.SEMICOLON],"Missing ',' or ';'")}return n||t.fail("Unexpected EOF"),e}var ot,lt=function(){function t(){Object(o.a)(this,t),this.gate=void 0,this.clockUp=void 0,this.time=void 0,this.userWorkspace=void 0,this.gate=null,this.clockUp=!1,this.time=0,this.userWorkspace=null}return Object(l.a)(t,[{key:"loadGate",value:function(t,e){this.gate=rt(t,e).newInstance(),this.userWorkspace=e}},{key:"step",value:function(){this.clockUp?this.performTock():this.performTick()}},{key:"performTock",value:function(){null!==this.gate&&(this.gate.tock(),this.clockUp=!1,this.time++)}},{key:"performTick",value:function(){null!==this.gate&&(this.gate.tick(),this.clockUp=!0)}},{key:"performEval",value:function(){null!==this.gate&&this.gate.eval()}},{key:"setInputPin",value:function(t,e){var n;null===(n=this.gate)||void 0===n||n.inputPins[t].set(e)}},{key:"getValue",value:function(t){if("time"===t)return this.time.toString()+(this.clockUp?"+":" ");var e,n=null===(e=this.gate)||void 0===e?void 0:e.getNode(t);if(n)return n.get().toString();throw new Error("incomplete getValue ".concat(t))}},{key:"setValue",value:function(t,e){if(null===this.gate)throw new Error("");var n=function(t){var e=t,n=10;e.startsWith("%B")&&(e=e.substring(2),n=2);return parseInt(e,n).toString()}(e);console.log(t,e,n);var i=parseInt(n),a=this.gate.getNode(t);a&&a.set(i)}},{key:"doCommand",value:function(t){if(console.log("doCommand",t),0!==t.length){var e=t[0];if("tick"===e)this.performTick();else if("tock"===e)this.performTock();else if("load"===e){if(!this.userWorkspace)return;this.loadGate(t[1].slice(0,-4),this.userWorkspace)}else"set"===e?this.setValue(t[1],t[2]):"eval"===e&&this.performEval()}else console.log("No command")}}]),t}();function ht(t){var e=t.script;return Object(f.jsx)("div",{className:"testScript",children:Object(f.jsx)("pre",{children:e})})}!function(t){t.IDENTIFIER="IDENTIFIER",t.INT="INT",t.EOF="EOF",t.REPEAT="REPEAT",t.OUTPUT_FILE="OUTPUT-FILE",t.COMPARE_TO="COMPARE-TO",t.OUTPUT_LIST="OUTPUT-LIST",t.OUTPUT="OUTPUT",t.SEMICOLON="SEMICOLON",t.COMMA="COMMA",t.LBRACE="{",t.RBRACE="}",t.INVALID="INVALID"}(ot||(ot={}));var dt=function(t){Object(T.a)(n,t);var e=Object(N.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return n}(Object(C.a)(Error)),pt=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.readpos=void 0,this.pos=void 0,this.cur=void 0,this.keywords=void 0,this.token={type:null,literal:null},this.input=e,this.readpos=0,this.pos=0,this.cur="",this.keywords={repeat:ot.REPEAT,"output-file":ot.OUTPUT_FILE,"compare-to":ot.COMPARE_TO,"output-list":ot.OUTPUT_LIST,output:ot.OUTPUT},this.readChar()}return Object(l.a)(t,[{key:"hasMoreTokens",value:function(){return this.token.type!==ot.EOF}},{key:"advance",value:function(){switch(this.skipWhitespaceAndComments(),this.token.literal=this.cur,this.cur){case";":this.token.type=ot.SEMICOLON;break;case",":this.token.type=ot.COMMA;break;case"{":this.token.type=ot.LBRACE;break;case"}":this.token.type=ot.RBRACE;break;case"":this.token.type=ot.EOF;break;default:if(vt(this.cur)){var t=this.readIdentifier();return this.token.type=this.lookupIdentifier(t),void(this.token.literal=t)}if(ft(this.cur))return this.token.type=ot.INT,void(this.token.literal=this.readNumber())}this.readChar()}},{key:"fail",value:function(e){t.fail(e)}},{key:"lookupIdentifier",value:function(t){var e;return null!==(e=this.keywords[t])&&void 0!==e?e:ot.IDENTIFIER}},{key:"readIdentifier",value:function(){for(var t=this.pos;vt(this.cur)||ft(this.cur)||"-"===this.cur||"."===this.cur;)this.readChar();return this.input.substring(t,this.pos)}},{key:"readNumber",value:function(){for(var t=this.pos;ft(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readChar",value:function(){this.cur=this.readpos>=this.input.length?"":this.input[this.readpos],this.pos=this.readpos,this.readpos++}},{key:"peekChar",value:function(){return this.readpos>=this.input.length?"":this.input[this.readpos]}},{key:"skipWhitespaceAndComments",value:function(){for(var t=!1,e=!1;;){var n=this.peekChar();if("/"===this.cur&&"/"===n)t=!0,this.readChar();else if(t&&"\n"===this.cur)t=!1;else if("/"===this.cur&&"*"===n)e=!0,this.readChar();else if(e&&"*"===this.cur&&"/"===n)e=!1,this.readChar();else if(!t&&!e&&" "!==this.cur&&"\t"!==this.cur&&"\n"!==this.cur&&"\r"!==this.cur)return;this.readChar()}}}],[{key:"fail",value:function(t){throw new dt(t)}}]),t}();function vt(t){var e=t.charCodeAt(0);return e>=65&&e<91||e>=97&&e<123||"%"===t}function ft(t){var e=t.charCodeAt(0);return e>=48&&e<58}var Ot,kt,bt=function t(e,n,i,a,s){Object(o.a)(this,t),this.varName=void 0,this.format=void 0,this.padL=void 0,this.padR=void 0,this.len=void 0,this.varName=e,this.format=n,this.padL=i,this.padR=a,this.len=s};!function(t){t[t.END=0]="END",t[t.SIMULATOR=1]="SIMULATOR",t[t.REPEAT=2]="REPEAT",t[t.REPEAT_END=3]="REPEAT_END",t[t.OUTPUT_FILE=4]="OUTPUT_FILE",t[t.COMPARE_TO=5]="COMPARE_TO",t[t.OUTPUT_LIST=6]="OUTPUT_LIST",t[t.OUTPUT=7]="OUTPUT"}(Ot||(Ot={})),function(t){t[t.SINGLE_STEP=0]="SINGLE_STEP",t[t.MINI_STEP=1]="MINI_STEP"}(kt||(kt={}));var It=function(){function t(e,n){Object(o.a)(this,t),this.code=void 0,this.args=void 0,this.terminator=void 0,this.code=e,this.args=n}return Object(l.a)(t,[{key:"getArg",value:function(){return this.args}},{key:"setTerminator",value:function(t){this.terminator=t}}]),t}(),Pt=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.commands=void 0,this.input=new pt(e),this.commands=[],this.buildScript()}return Object(l.a)(t,[{key:"getCommandAt",value:function(t){return this.commands[t]}},{key:"readArgs",value:function(t){for(var e=new Array(t),n=0;this.input.hasMoreTokens()&&this.input.token.type!==ot.SEMICOLON&&this.input.token.type!==ot.COMMA&&n<t;){var i;e[n]=null!==(i=this.input.token.literal)&&void 0!==i?i:"",this.input.advance(),n++}return e}},{key:"buildScript",value:function(){for(var t=null,e=!1;this.input.hasMoreTokens();){switch(this.input.advance(),this.input.token.type){case ot.REPEAT:t=this.createRepeatCommand(),e=!0;break;case ot.OUTPUT_FILE:t=this.createOutputFileCommand();break;case ot.COMPARE_TO:t=this.createCompareToCommand();break;case ot.OUTPUT_LIST:t=this.createOutputListCommand();break;case ot.OUTPUT:t=this.createOutputCommand();break;case ot.IDENTIFIER:var n=this.readArgs(4);t=new It(Ot.SIMULATOR,n);break;case ot.RBRACE:e&&(t=new It(Ot.REPEAT_END,[]),e=!1)}if(t)switch(this.commands.push(t),this.input.token.type){case ot.SEMICOLON:t.terminator=kt.SINGLE_STEP;break;case ot.COMMA:t.terminator=kt.MINI_STEP}t=null}t=new It(Ot.END,[]),this.commands.push(t)}},{key:"createOutputFileCommand",value:function(){this.input.advance();var t=this.readArgs(1);return new It(Ot.OUTPUT_FILE,t)}},{key:"createOutputCommand",value:function(){return this.input.advance(),new It(Ot.OUTPUT,[])}},{key:"createCompareToCommand",value:function(){this.input.advance();var t=this.readArgs(1);return new It(Ot.COMPARE_TO,t)}},{key:"createOutputListCommand",value:function(){this.input.advance();var t,e=this.readArgs(20);for(console.log(e),t=0;t<e.length&&void 0!==e[t];t++);for(var n=new Array(t),i=0;i<t;i++){var a=e[i].indexOf("%");-1===a&&(a=e[i].length,e[i]+="%B1.1.1");var s=e[i].substring(0,a),r=e[i].charAt(a+1),u=e[i].indexOf(".",a);if(-1===u)throw new Error("Missnig '.'");var c=parseInt(e[i].substring(a+2,u)),o=e[i].indexOf(".",u+1);if(-1===o)throw new Error("Missing '.'");var l=parseInt(e[i].substring(u+1,o)),h=parseInt(e[i].substring(o+1));n[i]=new bt(s,r,c,h,l)}return new It(Ot.OUTPUT_LIST,n)}},{key:"createRepeatCommand",value:function(){return this.input.advance(),this.input.token.type!==ot.LBRACE&&this.input.fail("Missing '{' in repeat command"),new It(Ot.REPEAT,[])}}]),t}(),gt=function(){function t(e){Object(o.a)(this,t),this.simulator=void 0,this.script=void 0,this.currentCommandIndex=void 0,this.loopCommandIndex=void 0,this.varList=void 0,this.output=void 0,this.simulator=e,this.script=null,this.currentCommandIndex=0,this.loopCommandIndex=0,this.varList=[],this.output=""}return Object(l.a)(t,[{key:"getGate",value:function(){return this.simulator.gate}},{key:"loadGate",value:function(t,e){this.simulator.loadGate(t,e)}},{key:"loadScript",value:function(t,e){var n,i=null!==(n=e.get(t))&&void 0!==n?n:"tick; tock;";this.script=new Pt(i)}},{key:"setInputPin",value:function(t,e){this.simulator.setInputPin(t,e)}},{key:"singleStep",value:function(){var t;do{t=this.miniStep()}while(t===kt.MINI_STEP)}},{key:"miniStep",value:function(){var t,e=!1;do{var n;if(!(t=null===(n=this.script)||void 0===n?void 0:n.getCommandAt(this.currentCommandIndex)))throw new Error("No command found.");switch(e=!1,t.code){case Ot.SIMULATOR:this.simulator.doCommand(t.getArg());break;case Ot.OUTPUT_FILE:console.log("output file");break;case Ot.COMPARE_TO:console.log("compare to");break;case Ot.OUTPUT_LIST:this.doOutputListCommand(t);break;case Ot.OUTPUT:this.doOutputCommand(t);break;case Ot.REPEAT:this.loopCommandIndex=this.currentCommandIndex+1,e=!0}if(t.code!==Ot.END){var i;this.currentCommandIndex++;var a=null===(i=this.script)||void 0===i?void 0:i.getCommandAt(this.currentCommandIndex);(null===a||void 0===a?void 0:a.code)===Ot.REPEAT_END&&(this.currentCommandIndex=this.loopCommandIndex)}}while(e);if(!t)throw new Error("No command found.");return t.terminator}},{key:"doOutputCommand",value:function(t){for(var e="|",n=0;n<this.varList.length;n++){var i=this.varList[n],a=this.simulator.getValue(i.varName);if("S"!==i.format){var s=parseInt(a);"B"===i.format&&(a=s.toString(2).padStart(16,"0"))}a.length>i.len&&(a=a.substring(a.length-i.len)),e+=" ".repeat(i.padL)+a+" ".repeat(i.padR)+"|"}this.outputAndCompare(e+"\n")}},{key:"doOutputListCommand",value:function(t){this.varList=t.getArg();for(var e="|",n=0;n<this.varList.length;n++){var i=this.varList[n],a=i.padL+i.padR+i.len,s=i.varName.length>a?i.varName.substring(0,a):i.varName,r=Math.floor((a-s.length)/2),u=a-r-s.length;e+=" ".repeat(r)+s+" ".repeat(u)+"|"}this.outputAndCompare(e+"\n")}},{key:"outputAndCompare",value:function(t){this.output+=t,console.log(this.output)}}]),t}();function Tt(){var t,e=Object(a.useState)(null),n=Object(c.a)(e,2),s=n[0],r=n[1],u=Object(a.useState)(null),o=Object(c.a)(u,2),l=o[0],h=o[1],d=Object(a.useState)("default.tst"),p=Object(c.a)(d,2),v=p[0],P=p[1],g=Object(a.useState)({input:[],output:[],internal:[]}),T=Object(c.a)(g,2),N=T[0],C=T[1],m=Object(a.useState)(null),y=Object(c.a)(m,2),j=y[0],A=y[1],U=Object(a.useState)("decimal"),E=Object(c.a)(U,2),M=E[0],R=E[1],L=Object(a.useRef)(new gt(new lt)),x=Object(a.useCallback)((function(){var t=L.current.getGate();if(!t)throw new Error("updatePinData: gate can not be null");var e=Nt(t,i.INPUT),n=Nt(t,i.OUTPUT),a=Nt(t,i.INTERNAL);C({input:e,output:n,internal:a})}),[]);Object(a.useEffect)((function(){if(l&&s&&l.endsWith(".hdl")){var t=l.slice(0,-4);try{L.current.loadGate(t,s),x(),A("Loaded successfully!")}catch(e){A("".concat(e))}}}),[l,s,x]),Object(a.useEffect)((function(){v&&s&&L.current.loadScript(v,s)}),[v,s]);var w,S=Object(a.useCallback)((function(){L.current.singleStep(),x()}),[x]),D=Object(a.useCallback)((function(t){var e=t.value,n=t.number;t.type===i.INPUT&&(L.current.setInputPin(n,parseInt(e)||0),x())}),[x]),F="No hdl file";s&&l&&(F=null!==(w=s.get(l))&&void 0!==w?w:"");null===s||void 0===s||s.set("default.tst","repeat {\n    tick,\n    tock;\n}");var B=null!==(t=v?null===s||void 0===s?void 0:s.get(v):null)&&void 0!==t?t:"No test found";return Object(f.jsxs)("div",{id:"hardwareSimulator",children:[Object(f.jsx)("div",{className:"header",children:Object(f.jsx)("h1",{children:"HardwareSimulator"})}),Object(f.jsx)(O,{hdlFilename:l,setHDLFileName:h,userWorkspace:s,setUserWorkspace:r,testScript:v,setTestScript:P,setFormat:R,singleStep:S}),Object(f.jsxs)("div",{className:"container",children:[Object(f.jsx)(b,{title:"Input Pins",type:i.INPUT,pinData:N.input,updatePin:D,format:M}),Object(f.jsx)(b,{title:"Output Pins",type:i.OUTPUT,pinData:N.output,updatePin:D,format:M}),Object(f.jsx)(ht,{script:B}),Object(f.jsx)(k,{hdl:F}),Object(f.jsx)(b,{title:"Internal Pins",type:i.INTERNAL,pinData:N.internal,updatePin:D,format:M})]}),Object(f.jsx)(I,{status:j})]})}function Nt(t,e){var n=[];switch(e){case i.INPUT:return n=t.gateClass.inputPinsInfo,t.inputPins.map((function(t,e){return{name:n[e].name,value:t.value[0].toString()}}));case i.OUTPUT:return n=t.gateClass.outputPinsInfo,t.outputPins.map((function(t,e){return{name:n[e].name,value:t.value[0].toString()}}));case i.INTERNAL:var a=t;if(!a)return[];var s=a.gateClass;return s?(n=s.internalPinsInfo,a.internalPins.map((function(t,e){return{name:n[e].name,value:t.value[0].toString()}}))):[];default:throw new Error("pinType is ".concat(e))}}function Ct(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(Tt,{})})}var mt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,28)).then((function(e){var n=e.getCLS,i=e.getFID,a=e.getFCP,s=e.getLCP,r=e.getTTFB;n(t),i(t),a(t),s(t),r(t)}))};u.a.render(Object(f.jsx)(s.a.StrictMode,{children:Object(f.jsx)(Ct,{})}),document.getElementById("root")),mt()}},[[27,1,2]]]);
//# sourceMappingURL=main.f1bf166c.chunk.js.map