{"version":3,"sources":["hack/gates/gateclass.ts","hack/guis/hardware-simulator/actions.tsx","hack/guis/hardware-simulator/hdl-viewer.tsx","hack/guis/hardware-simulator/pins.tsx","hack/guis/hardware-simulator/status-message.tsx","hack/hdl/tokenizer.ts","hack/hdl/parser.ts","hack/gates/gate.ts","hack/gates/builtin-gate.ts","hack/gates/builtins/logic.ts","hack/gates/builtins/arithmetic.ts","hack/gates/builtins/memory.ts","hack/gates/builtins/computer.ts","hack/gates/builtins/index.ts","hack/gates/node.ts","hack/gates/builtin-gateclass.ts","hack/gates/connection.ts","hack/gates/composite-gate.ts","hack/gates/composite-gateclass.ts","hack/gates/index.ts","hack/simulators/hardware-simulator.ts","hack/guis/hardware-simulator/test-script.tsx","hack/guis/hardware-simulator/index.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["PinType","GateClass","name","inputPinsInfo","outputPinsInfo","namesToTypes","namesToNumbers","isClocked","isInputClocked","isOutputClocked","this","registerPins","INPUT","OUTPUT","pinType","pinNumber","length","pinName","UNKNOWN","pinInfos","type","forEach","pinInfo","i","registerPin","Actions","hdlFileName","setHDLFileName","userDefinedParts","setUserDefinedParts","testScript","setTestScript","testScripts","setTestScripts","singleStep","setFormat","setWorkingDirectory","useCallback","e","a","files","target","Error","Map","file","endsWith","firstHDLFile","text","set","scripts","Array","from","keys","className","webkitdirectory","directory","mozdirectory","onChange","value","map","filename","selected","onClick","HDLViewer","hdl","Pins","title","pinData","updatePin","format","number","data","displayValue","int","parseInt","toString","formatValue","StatusMessage","status","TokenType","HDLError","HDLTokenizer","input","readpos","pos","cur","keywords","token","literal","CHIP","IN","OUT","PARTS","BUILTIN","CLOCKED","true","TRUE","false","FALSE","readChar","EOF","skipWhitespaceAndComments","LBRACE","RBRACE","LPAREN","RPAREN","LBRACKET","RBRACKET","EQUAL","COMMA","DOT","COLON","SEMICOLON","isLetter","ident","readIdentifier","lookupIdentifier","isDigit","INT","readNumber","message","fail","IDENTIFIER","substring","inSlashComment","inStarComment","peek","peekChar","char","n","charCodeAt","HDLParser","advance","tokenIs","failMessage","peekTokenIs","types","includes","Gate","inputPins","outputPins","gateClass","getPinType","index","getPinNumber","console","log","doEval","clockUp","clockDown","reCompute","BuiltInGate","Not","_in","get","Not16","And","b","Xor","gates","Or","Mux","sel","Mux4Way16","c","d","out","Mux8Way16","f","g","h","DMux","DMux4Way","DMux8Way","Or8Way","HalfAdder","FullAdder","sum","Add16","Inc16","ALU","x","y","result","Bit","state","Register","PC","load","inc","RAM","size","values","Uint16Array","address","RAM8","RAM64","RAM512","RAM4K","RAM16K","Screen","Keyboard","key","ROM32K","SIZE","builtins","Nand","gate","DFF","logic","And16","Or16","Mux16","arithmetic","memory","computer","Node","connections","node","Set","add","delete","SubNode","low","high","mask","shiftRight","getMask","SubBusListeningAdapter","shiftLeft","masked1","masked2","POWERS_OF_2","bitHolder","ConnectionType","BuiltInGateClass","parser","tsClassName","expectPeek","clockedPins","readPinsInfo","inputFound","outputFound","j","inputNodes","_","outputNodes","CompositeGate","internalPins","parts","eval","tock","tick","INTERNAL","CompositeGateClass","partsList","internalPinsInfo","readParts","subNode","partClass","newInstance","internalNodes","internalConnections","partNode","gateSubBus","partSubBus","connection","partNumber","getNode","partPinName","FROM_INPUT","connectGateToPart","gatePinNumber","TO_OUTPUT","TO_INTERNAL","connect","FROM_INTERNAL","FROM_TRUE","FROM_FALSE","source","sourceNode","sourceSubBus","targetNode","targetSubBus","endOfParts","hasMoreTokens","partName","getGateClass","push","readPinNames","endOfPins","leftName","leftSubBus","readSubBus","rightPinPossibilities","expectPeekOneOf","rightName","rightSubBus","addConnection","partGateClass","leftType","rightPinInfo","leftNumber","leftPinInfo","getPinInfo","leftWidth","width","rightType","rightNumber","selfFittingWidth","connectionType","INVALID","rightWidth","has","getGateClassHDL","getGateClassBuiltIn","tokenizer","expectCurrent","gateName","readHDL","exit","pinWidth","HardwareSimulator","performTock","performTick","TestScript","script","HardwareSimulatorUI","useState","gateFilename","setGateFilename","output","internal","setPinData","setStatus","simulator","useRef","updatePinData","current","getPinData","useEffect","slice","loadGate","error","step","updateInputPin","setInputPin","displayScript","id","compositeGate","compositeClass","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4903893a.chunk.js","sourcesContent":["import { Gate } from \"./gate\"\n\nexport enum PinType {\n    INPUT = \"INPUT\",\n    OUTPUT = \"OUTPUT\",\n    INTERNAL = \"INTERNAL\",\n    UNKNOWN = \"UNKNOWN\"\n}\n\nexport type PinInfo = {\n    name: string\n    width: number\n}\n\nexport abstract class GateClass {\n    namesToTypes: { [_: string]: PinType }\n    namesToNumbers: { [_: string]: number }\n\n    name: string\n\n    inputPinsInfo: PinInfo[]\n    outputPinsInfo: PinInfo[]\n\n    isClocked: boolean\n    isInputClocked: boolean[]\n    isOutputClocked: boolean[]\n\n    constructor(name: string, inputPinsInfo: PinInfo[], outputPinsInfo: PinInfo[]) {\n        this.name = name\n        this.namesToTypes = {}\n        this.namesToNumbers = {}\n\n        this.inputPinsInfo = inputPinsInfo\n        this.registerPins(inputPinsInfo, PinType.INPUT)\n        this.outputPinsInfo = outputPinsInfo\n        this.registerPins(outputPinsInfo, PinType.OUTPUT)\n\n        this.isClocked = false\n        this.isInputClocked = []\n        this.isOutputClocked = []\n    }\n\n    abstract newInstance(): Gate\n\n    getPinInfo(pinType: PinType, pinNumber: number): PinInfo | null {\n        switch (pinType) {\n            case PinType.INPUT:\n                if (pinNumber < this.inputPinsInfo.length) {\n                return this.inputPinsInfo[pinNumber]\n            }\n            break\n            case PinType.OUTPUT:\n                if (pinNumber < this.outputPinsInfo.length) {\n                return this.outputPinsInfo[pinNumber]\n            }\n            break\n        }\n        return null\n    }\n\n    getPinType(pinName: string): PinType {\n        return this.namesToTypes[pinName] ?? PinType.UNKNOWN\n    }\n\n    getPinNumber(pinName: string): number {\n        return this.namesToNumbers[pinName] ?? -1\n    }\n\n    registerPins(pinInfos: PinInfo[], type: PinType) {\n        pinInfos.forEach((pinInfo, i) => {\n            this.registerPin(pinInfo, type, i)\n        })\n    }\n\n    registerPin(pinInfo: PinInfo, type: PinType, pinNumber: number) {\n        this.namesToTypes[pinInfo.name] = type\n        this.namesToNumbers[pinInfo.name] = pinNumber\n    }\n}\n","import { AriaAttributes, ChangeEvent, DOMAttributes, useCallback } from \"react\"\nimport { UserDefinedParts } from \"../../gates/composite-gateclass\"\n\nexport type ActionsProps = {\n  hdlFileName: string | null\n  setHDLFileName: (_: string | null) => void\n  userDefinedParts: UserDefinedParts | null\n  setUserDefinedParts: (_: UserDefinedParts | null) => void\n  testScript: string | null\n  setTestScript: (_: string | null) => void\n  testScripts: Map<string, string> | null\n  setTestScripts: (_: Map<string, string> | null) => void\n  singleStep: () => void\n  setFormat: (_: string) => void\n}\n\nexport function Actions({ hdlFileName, setHDLFileName, userDefinedParts, setUserDefinedParts, testScript, setTestScript, testScripts, setTestScripts, singleStep, setFormat }: ActionsProps) {\n  // TODO: make a better approach\n  const setWorkingDirectory = useCallback(async (e: ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files) {\n      throw new Error(\"no files found\")\n    }\n    let userDefinedParts = new Map<string, string>()\n    let testScripts = new Map<string, string>()\n    let firstHDLFile\n    for (let i=0; i<files.length; i++) {\n      const file = files[i]\n      if (file.name.endsWith(\".hdl\")) {\n        if (!firstHDLFile) {\n          firstHDLFile = file\n        }\n        userDefinedParts.set(file.name, await file.text())\n      } else if (file.name.endsWith(\".tst\")) {\n        testScripts.set(file.name, await file.text())\n      }\n    }\n    setTestScripts(testScripts)\n    setUserDefinedParts(userDefinedParts)\n    if (firstHDLFile) {\n      setHDLFileName(firstHDLFile.name)\n    }\n  }, [setHDLFileName, setUserDefinedParts, setTestScripts])\n\n  const scripts = Array.from(testScripts?.keys() ?? [])\n\n  return (\n    <div className=\"actions\">\n      <input type=\"file\" webkitdirectory=\"\" directory=\"\" mozdirectory=\"\" onChange={setWorkingDirectory} />\n      <select onChange={(e) => setHDLFileName(e.target.value)}>\n      {Array.from(userDefinedParts?.keys() ?? []).map((filename) => {\n        if (filename === hdlFileName) {\n          return (<option selected key={filename} value={filename}>{filename}</option>)\n        } else {\n          return (<option key={filename} value={filename}>{filename}</option>)\n        }\n      })}\n      </select>\n      <select onChange={(e) => setTestScript(e.target.value)}>\n      {\n        scripts.map((filename) => {\n          if (filename === testScript) {\n            return (<option selected key={filename} value={filename}>{filename}</option>)\n          } else {\n            return (<option key={filename} value={filename}>{filename}</option>)\n          }\n        })\n      }\n      </select>\n      <select onChange={(e) => setFormat(e.target.value)}>\n        <option key=\"decimal\" value=\"decimal\">Decimal</option>\n        <option key=\"binary\" value=\"binary\">Binary</option>\n        <option key=\"hexadecimal\" value=\"hexadecimal\">Hexadecimal</option>\n      </select>\n      <button onClick={singleStep}>Single Step</button>\n      </div>\n  )\n}\n\ndeclare module \"react\" {\n  interface HTMLAttributes<T> extends AriaAttributes, DOMAttributes<T> {\n    directory?: string\n    webkitdirectory?: string\n    mozdirectory?: string\n  }\n}\n","export type HDLViewerProps = {\n  hdl: string | null\n}\n\nexport function HDLViewer({ hdl }: HDLViewerProps) {\n  return (<div className=\"hdlViewer\"><pre>{hdl}</pre></div>)\n}\n","import { useCallback } from \"react\"\nimport { PinData, PinUpdate } from \".\"\nimport { PinType } from \"../../gates/gateclass\"\n\nexport type PinsProps = {\n  title: string\n  type: PinType\n  pinData: PinData[]\n  updatePin: (data: PinUpdate) => void\n  format: string\n}\n\nexport function Pins({ title, type, pinData, updatePin, format }: PinsProps) {\n  const onChange = useCallback((value: string, number: number, type: PinType) => {\n    updatePin({ value, number, type })\n  }, [updatePin])\n\n  return (\n    <div className=\"pins\">\n      <h3>{title}</h3>\n      <table>\n        <tbody>\n          {pinData.map((data, i) => {\n            const { name, value } = data\n            const displayValue = type === PinType.INPUT ? value : formatValue(value, format)\n            return (<tr key={i}>\n                    <td>{name}</td>\n                    <td><input value={displayValue} onChange={(e) => onChange(e.target.value, i, type)} /></td>\n                    </tr>)\n          })}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\nexport function formatValue(value: string, format: string): string {\n  const int = parseInt(value) ?? 0\n  switch (format) {\n    case \"binary\":\n      return int.toString(2)\n    case \"hexadecimal\":\n      return int.toString(16)\n    default:\n      return int.toString()\n  }\n}\n","export type StatusMessageProps = {\n  status: string | null\n}\n\nexport function StatusMessage({ status }: StatusMessageProps) {\n  return (<div className=\"statusMessage\">{status}</div>)\n}\n","export enum TokenType {\n  IDENTIFIER = 'IDENTIFIER',\n\n  TRUE = 'true',\n  FALSE = 'false',\n  CHIP = 'CHIP',\n  IN = 'IN',\n  OUT = 'OUT',\n  PARTS = 'PARTS',\n  BUILTIN = 'BUILTIN',\n  CLOCKED = 'CLOCKED',\n\n  INT = 'INT',\n  LBRACE = 'LBRACE',\n  RBRACE = 'RBRACE',\n  LBRACKET = 'LBRACKET',\n  RBRACKET = 'RBRACKET',\n  LPAREN = 'LPAREN',\n  RPAREN = 'RPAREN',\n  COLON = 'COLON',\n  EQUAL = 'EQUAL',\n  COMMA = 'COMMA',\n  SEMICOLON = 'SEMICOLON',\n  DOT = 'DOT',\n  INVALID = 'INVALID',\n\n  EOF = 'EOF',\n}\n\nexport class HDLError extends Error {}\n\nexport type Token = {\n  type: TokenType | null\n  literal: string | null\n}\n\nexport class HDLTokenizer {\n  private input: string\n  private readpos: number\n  private pos: number\n  private cur: string\n  private keywords: { [_: string]: TokenType }\n\n  // current token\n  token: Token = { type: null, literal: null }\n\n  constructor (input: string) {\n    this.input = input\n    this.readpos = 0\n    this.pos = 0\n    this.cur = ''\n    this.keywords = {\n      CHIP: TokenType.CHIP,\n      IN: TokenType.IN,\n      OUT: TokenType.OUT,\n      PARTS: TokenType.PARTS,\n      BUILTIN: TokenType.BUILTIN,\n      CLOCKED: TokenType.CLOCKED,\n      true: TokenType.TRUE,\n      false: TokenType.FALSE\n    }\n\n    this.readChar()\n  }\n\n  hasMoreTokens (): boolean {\n    return this.token.type !== TokenType.EOF\n  }\n\n  advance () {\n    this.skipWhitespaceAndComments()\n\n    this.token.literal = this.cur\n    switch (this.cur) {\n      case '{':\n        this.token.type = TokenType.LBRACE\n        break\n      case '}':\n        this.token.type = TokenType.RBRACE\n        break\n      case '(':\n        this.token.type = TokenType.LPAREN\n        break\n      case ')':\n        this.token.type = TokenType.RPAREN\n        break\n      case '[':\n        this.token.type = TokenType.LBRACKET\n        break\n      case ']':\n        this.token.type = TokenType.RBRACKET\n        break\n      case '=':\n        this.token.type = TokenType.EQUAL\n        break\n      case ',':\n        this.token.type = TokenType.COMMA\n        break\n      case '.':\n        this.token.type = TokenType.DOT\n        break\n      case ':':\n        this.token.type = TokenType.COLON\n        break\n      case ';':\n        this.token.type = TokenType.SEMICOLON\n        break\n      case '':\n        this.token.type = TokenType.EOF\n        break\n      default:\n        if (isLetter(this.cur)) {\n          const ident = this.readIdentifier()\n          this.token.type = this.lookupIdentifier(ident)\n          this.token.literal = ident\n          return\n        } else if (isDigit(this.cur)) {\n          this.token.type = TokenType.INT\n          this.token.literal = this.readNumber()\n          return\n        }\n    }\n\n    this.readChar()\n  }\n\n  fail (message: string): never {\n    HDLTokenizer.fail(message)\n  }\n\n  static fail (message: string): never {\n    throw new HDLError(message)\n  }\n\n  private lookupIdentifier (ident: string): TokenType {\n    return this.keywords[ident] ?? TokenType.IDENTIFIER\n  }\n\n  private readIdentifier (): string {\n    const pos = this.pos\n    while (isLetter(this.cur) || isDigit(this.cur)) {\n      this.readChar()\n    }\n    return this.input.substring(pos, this.pos)\n  }\n\n  private readNumber (): string {\n    const pos = this.pos\n    while (isDigit(this.cur)) {\n      this.readChar()\n    }\n    return this.input.substring(pos, this.pos)\n  }\n\n  private readChar () {\n    this.cur = this.readpos >= this.input.length ? '' : this.input[this.readpos]\n    this.pos = this.readpos\n    this.readpos++\n  }\n\n  private peekChar () {\n    return this.readpos >= this.input.length ? '' : this.input[this.readpos]\n  }\n\n  private skipWhitespaceAndComments () {\n    let inSlashComment = false\n    let inStarComment = false\n\n    while (true) {\n      const peek = this.peekChar()\n\n      // isSlashCommentStart\n      if (this.cur === '/' && peek === '/') {\n        inSlashComment = true\n        this.readChar() // read peek as well\n        // isSlashCommentEnd\n      } else if (inSlashComment && this.cur === '\\n') {\n        inSlashComment = false\n        // isStarCommentStart\n      } else if (this.cur === '/' && peek === '*') {\n        inStarComment = true\n        this.readChar() // read peek as well\n        // isStarCommentEnd\n      } else if (inStarComment && (this.cur === '*' && peek === '/')) {\n        inStarComment = false\n        this.readChar() // read peek as well\n      } else if (!inSlashComment && !inStarComment && !(this.cur === ' ' || this.cur === '\\t' ||\n                                                        this.cur === '\\n' || this.cur === '\\r')) {\n        return\n      }\n\n      this.readChar()\n    }\n  }\n}\n\nfunction isLetter (char: string): boolean {\n  const n = char.charCodeAt(0)\n  return (n >= 65 && n < 91) || (n >= 97 && n < 123)\n}\n\nfunction isDigit (char: string): boolean {\n  const n = char.charCodeAt(0)\n  return (n >= 48 && n < 58)\n}\n\n","import { HDLTokenizer, Token, TokenType } from \"./tokenizer\";\n\nexport class HDLParser {\n  private input: HDLTokenizer\n\n  token: Token = { literal: null, type: null }\n  peek: Token = { literal: null, type: null }\n\n  constructor(input: HDLTokenizer) {\n    this.input = input\n    this.advance()\n    this.advance()\n  }\n\n  advance () {\n    this.token = {...this.peek}\n    this.input.advance()\n    this.peek = {...this.input.token}\n  }\n\n  hasMoreTokens (): boolean {\n    return !this.tokenIs(TokenType.EOF)\n  }\n\n  tokenIs (type: TokenType): boolean {\n    return this.token.type === type\n  }\n\n  peekTokenIs (type: TokenType): boolean {\n    return this.peek.type === type\n  }\n\n  expectCurrent (type: TokenType, failMessage: string) {\n    if (!this.tokenIs(type)) {\n      this.fail(failMessage)\n    }\n  }\n\n  expectPeek (type: TokenType, failMessage: string): void | never {\n    if (this.peekTokenIs(type)) {\n      this.advance()\n    } else {\n      this.fail(failMessage)\n    }\n  }\n\n  expectPeekOneOf (types: TokenType[], failMessage: string): void | never {\n    if (this.peek.type && types.includes(this.peek.type)) {\n      this.advance()\n    } else {\n      this.fail(failMessage)\n    }\n  }\n\n  fail (message: string): never {\n    this.input.fail(message)\n  }\n\n  static fail (message: string): never {\n    HDLTokenizer.fail(message)\n  }\n}\n","import { GateClass, PinType } from \"./gateclass\"\nimport { Node } from \"./node\"\n\nexport abstract class Gate {\n    gateClass: GateClass\n    inputPins: Node[]\n    outputPins: Node[]\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        this.inputPins = inputPins\n        this.outputPins = outputPins\n        this.gateClass = gateClass\n    }\n\n    abstract reCompute(): void\n    abstract clockUp(): void\n    abstract clockDown(): void\n\n    getNode(name: string): Node | null {\n        const type = this.gateClass.getPinType(name)\n        const index = this.gateClass.getPinNumber(name)\n        switch (type) {\n            case PinType.INPUT:\n                return this.inputPins[index]\n            case PinType.OUTPUT:\n                return this.outputPins[index]\n        }\n        return null\n    }\n\n    tick() {\n        console.log(\"Gate tick()\")\n        this.doEval()\n        this.clockUp()\n    }\n\n    tock() {\n        console.log(\"Gate tock()\")\n        this.clockDown()\n        this.doEval()\n    }\n\n    eval() {\n        this.doEval()\n    }\n\n    doEval() {\n        this.reCompute()\n    }\n}\n\n","import { Gate } from \"./gate\";\n\nexport class BuiltInGate extends Gate {\n    reCompute() {}\n    clockUp() {}\n    clockDown() {}\n}\n","import { BuiltInGate } from \"./../builtin-gate\"\n\nexport class Not extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        this.outputPins[0].set(1 - _in)\n    }\n}\n\nexport class Not16 extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        this.outputPins[0].set(~_in)\n    }\n}\n\nexport class And extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(a & b)\n    }\n}\n\nexport class Xor extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(a ^ b)\n    }\n}\n\nexport class Or extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(a | b)\n    }\n}\n\nexport class Mux extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        const sel = this.inputPins[2].get()\n        this.outputPins[0].set(sel === 0 ? a : b)\n    }\n}\n\nexport class Mux4Way16 extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        const c = this.inputPins[2].get()\n        const d = this.inputPins[3].get()\n        const sel = this.inputPins[4].get()\n        let out = 0\n        switch (sel) {\n            case 0: out = a; break\n            case 1: out = b; break\n            case 2: out = c; break\n            case 3: out = d; break\n        }\n        this.outputPins[0].set(out)\n    }\n}\n\nexport class Mux8Way16 extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        const c = this.inputPins[2].get()\n        const d = this.inputPins[3].get()\n        const e = this.inputPins[4].get()\n        const f = this.inputPins[5].get()\n        const g = this.inputPins[6].get()\n        const h = this.inputPins[7].get()\n        const sel = this.inputPins[8].get()\n        let out = 0\n        switch (sel) {\n            case 0: out = a; break\n            case 1: out = b; break\n            case 2: out = c; break\n            case 3: out = d; break\n            case 4: out = e; break\n            case 5: out = f; break\n            case 6: out = g; break\n            case 7: out = h; break\n        }\n        this.outputPins[0].set(out)\n    }\n}\n\nexport class DMux extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        const sel = this.inputPins[1].get()\n        this.outputPins[0].set(sel === 0 ? _in : 0)\n        this.outputPins[1].set(sel === 0 ? 0 : _in)\n    }\n}\n\nexport class DMux4Way extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        const sel = this.inputPins[1].get()\n        this.outputPins[0].set(sel === 0 ? _in : 0)\n        this.outputPins[1].set(sel === 1 ? _in : 0)\n        this.outputPins[2].set(sel === 2 ? _in : 0)\n        this.outputPins[3].set(sel === 3 ? _in : 0)\n    }\n}\n\nexport class DMux8Way extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        const sel = this.inputPins[1].get()\n        this.outputPins[0].set(sel === 0 ? _in : 0)\n        this.outputPins[1].set(sel === 1 ? _in : 0)\n        this.outputPins[2].set(sel === 2 ? _in : 0)\n        this.outputPins[3].set(sel === 3 ? _in : 0)\n        this.outputPins[4].set(sel === 4 ? _in : 0)\n        this.outputPins[5].set(sel === 5 ? _in : 0)\n        this.outputPins[6].set(sel === 6 ? _in : 0)\n        this.outputPins[7].set(sel === 7 ? _in : 0)\n    }\n}\n\nexport class Or8Way extends BuiltInGate {\n    reCompute() {\n        const _in = this.inputPins[0].get()\n        this.outputPins[0].set(_in === 0 ? 0 : 1)\n    }\n}\n\nconst gates = {\n    Not,\n    Not16,\n    And,\n    Or,\n    Xor,\n    Mux,\n    Mux4Way16,\n    Mux8Way16,\n    DMux,\n    DMux4Way,\n    DMux8Way,\n    Or8Way\n}\n\nexport default gates\n","import { BuiltInGate } from \"./../builtin-gate\"\n\nexport class HalfAdder extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(a ^ b)\n        this.outputPins[1].set(a & b)\n    }\n}\n\nexport class FullAdder extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        const c = this.inputPins[2].get()\n        const sum = a + b + c\n        this.outputPins[0].set(sum % 2)\n        this.outputPins[1].set(sum / 2)\n    }\n}\n\nexport class Add16 extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(a + b)\n    }\n}\n\nexport class Inc16 extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        this.outputPins[0].set(a + 1)\n    }\n}\n\nexport class ALU extends BuiltInGate {\n    reCompute() {\n        let x = this.inputPins[0].get()\n        let y = this.inputPins[1].get()\n        const zx = this.inputPins[2].get()\n        const nx = this.inputPins[3].get()\n        const zy = this.inputPins[4].get()\n        const ny = this.inputPins[5].get()\n        const f = this.inputPins[6].get()\n        const no = this.inputPins[7].get()\n\n        if (zx) { x = 0 }\n        if (nx) { x = ~x }\n        if (zy) { y = 0 }\n        if (ny) { y = ~y }\n        let result = f === 1 ? (x+y) : (x&y)\n        if (no) { result = ~result }\n\n        this.outputPins[0].set(result) // out\n        this.outputPins[1].set(result === 0 ? 1 : 0) // zr\n        this.outputPins[2].set(result < 0 ? 1 : 0) // ng\n    }\n}\n\nconst gates = { HalfAdder, FullAdder, Add16, Inc16, ALU }\n\nexport default gates\n","import { BuiltInGate } from \"./../builtin-gate\"\nimport { GateClass } from \"../gateclass\"\nimport { Node } from \"../node\"\n\nexport class Bit extends BuiltInGate {\n    state: number\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.state = 0\n    }\n\n    clockUp() {\n        const load = this.inputPins[1].get()\n        if (load === 1)\n            this.state = this.inputPins[0].get()\n    }\n\n    clockDown() {\n        this.outputPins[0].set(this.state)\n    }\n}\n\nexport class Register extends BuiltInGate {\n    state: number\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.state = 0\n    }\n\n    clockUp() {\n        const load = this.inputPins[1].get()\n        if (load === 1)\n            this.state = this.inputPins[0].get()\n    }\n\n    clockDown() {\n        this.outputPins[0].set(this.state)\n    }\n}\n\nexport class PC extends BuiltInGate {\n    value: number\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.value = 0\n    }\n\n    clockUp() {\n        const _in = this.inputPins[0].get()\n        const load = this.inputPins[1].get()\n        const inc = this.inputPins[2].get()\n        const reset = this.inputPins[3].get()\n        if (reset === 1)\n            this.value = 0\n        else if (load === 1)\n            this.value = _in\n        else if (inc === 1)\n            this.value++\n    }\n\n    clockDown() {\n        this.outputPins[0].set(this.value)\n    }\n}\n\nexport class RAM extends BuiltInGate {\n    size: number\n\n    values: Uint16Array\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass, size: number) {\n        super(inputPins, outputPins, gateClass)\n        this.size = size\n        this.values = new Uint16Array(size)\n    }\n\n    clockUp() {\n        const _in = this.inputPins[0].get()\n        const load = this.inputPins[1].get()\n        const address = this.inputPins[2].get()\n        if (load === 1) {\n            this.values[address] = _in\n        }\n    }\n\n    clockDown() {\n        this.reCompute()\n    }\n\n    reCompute() {\n        const address = this.inputPins[2].get()\n        this.outputPins[0].set(this.values[address])\n    }\n}\n\nexport class RAM8 extends RAM {\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass, 8)\n    }\n}\n\nexport class RAM64 extends RAM {\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass, 64)\n    }\n}\n\nexport class RAM512 extends RAM {\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass, 512)\n    }\n}\n\nexport class RAM4K extends RAM {\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass, 4096)\n    }\n}\n\nexport class RAM16K extends RAM {\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass, 16384)\n    }\n}\n\nconst gates = { Bit, Register, PC, RAM, RAM8, RAM64, RAM512, RAM4K, RAM16K }\nexport default gates\n","import { BuiltInGate } from \"./../builtin-gate\"\nimport { GateClass } from \"../gateclass\"\nimport { Node } from \"../node\"\n\nexport class Screen extends BuiltInGate {\n    values: Uint16Array\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.values = new Uint16Array(32 * 256)\n    }\n\n    clockUp() {\n        const _in = this.inputPins[0].get()\n        const load = this.inputPins[1].get()\n        const address = this.inputPins[2].get()\n        if (load === 1) {\n            this.values[address] = _in\n        }\n    }\n\n    reCompute() {\n        const address = this.inputPins[2].get()\n        this.outputPins[0].set(this.values[address])\n    }\n\n    clockDown() {\n        this.reCompute()\n    }\n}\n\nexport class Keyboard extends BuiltInGate {\n    key: number\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.key = -1\n    }\n}\n\nexport class ROM32K extends BuiltInGate {\n    static SIZE = 32768\n\n    values: Uint16Array\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.values = new Uint16Array(ROM32K.SIZE)\n    }\n\n    reCompute() {\n        const address = this.inputPins[0].get()\n        this.outputPins[0].set(this.values[address])\n    }\n}\n\nconst gates = { Screen, Keyboard, ROM32K }\nexport default gates\n","import { BuiltInGate } from \"../builtin-gate\"\nimport { GateClass } from \"../gateclass\"\nimport { Node } from \"../node\"\n\nimport logic from \"./logic\"\nimport arithmetic from \"./arithmetic\"\nimport memory from \"./memory\"\nimport computer from \"./computer\"\n\nexport class Nand extends BuiltInGate {\n    reCompute() {\n        const a = this.inputPins[0].get()\n        const b = this.inputPins[1].get()\n        this.outputPins[0].set(0x1 - (a & b))\n    }\n}\n\nexport class DFF extends BuiltInGate {\n    state: number\n\n    constructor(inputPins: Node[], outputPins: Node[], gateClass: GateClass) {\n        super(inputPins, outputPins, gateClass)\n        this.state = 0\n    }\n\n    clockUp() {\n        this.state = this.inputPins[0].get()\n    }\n\n    clockDown() {\n        this.outputPins[0].set(this.state)\n    }\n}\n\nexport type BuiltInDef = { hdl: string, gate: typeof BuiltInGate }\nexport type BuiltIns = { [_: string]: BuiltInDef }\n\nexport const builtins: BuiltIns = {\n    // GIVEN\n    Nand: {\n        hdl: `CHIP Nand { IN  a, b; OUT out; BUILTIN Nand; }`,\n        gate: Nand\n    },\n    DFF: {\n        hdl: `CHIP DFF { IN  in; OUT out; BUILTIN DFF; CLOCKED in; }`,\n        gate: DFF\n    },\n    // LOGIC\n    Not: {\n        hdl: `CHIP Not { IN  in; OUT out; BUILTIN Not; } `,\n        gate: logic.Not   \n    },\n    Not16: {\n      hdl: `CHIP Not16 { IN  in[16]; OUT out[16]; BUILTIN Not16; }`,\n      gate: logic.Not16\n    },\n    And: {\n      hdl: `CHIP And { IN  a, b; OUT out; BUILTIN And; } `,\n      gate: logic.And\n    },\n    And16: {\n      hdl: `CHIP And16 { IN  a[16], b[16]; OUT out[16]; BUILTIN And; }`,\n      gate: logic.And\n    },\n    Or: {\n      hdl: `CHIP Or { IN  a, b; OUT out; BUILTIN Or; }`,\n      gate: logic.Or\n    },\n    Or16: {\n      hdl: `CHIP Or16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Or; }`,\n      gate: logic.Or\n    },\n    Xor: {\n      hdl: `CHIP Xor { IN  a, b; OUT out; BUILTIN Xor; }`,\n      gate: logic.Xor\n    },\n    Mux: {\n      hdl: `CHIP Mux { IN  a, b, sel; OUT out; BUILTIN Mux;}`,\n      gate: logic.Mux\n    },\n    Mux16: {\n      hdl: `CHIP Mux16 { IN  a[16], b[16], sel; OUT out[16]; BUILTIN Mux; }`,\n      gate: logic.Mux\n    },\n    Mux4Way16: {\n      hdl: ` CHIP Mux4Way16 { IN a[16], b[16], c[16], d[16], sel[2]; OUT out[16]; BUILTIN Mux4Way16; }`,\n      gate: logic.Mux4Way16\n    },\n    Mux8Way16: {\n      hdl: `CHIP Mux8Way16 { IN  a[16], b[16], c[16], d[16], e[16], f[16], g[16], h[16], sel[3]; OUT out[16]; BUILTIN Mux8Way16; }`,\n      gate: logic.Mux8Way16\n    },\n    DMux: {\n      hdl: `CHIP DMux { IN  in, sel; OUT a, b; BUILTIN DMux; }`,\n      gate: logic.DMux\n    },\n    DMux4Way: {\n      hdl: `CHIP DMux4Way { IN  in, sel[2]; OUT a, b, c, d; BUILTIN DMux4Way; }`,\n      gate: logic.DMux4Way\n    },\n    DMux8Way: {\n      hdl: `CHIP DMux8Way { IN  in, sel[3]; OUT a, b, c, d, e, f, g, h; BUILTIN DMux8Way; }`,\n      gate: logic.DMux8Way\n    },\n    Or8Way: {\n      hdl: `CHIP Or8Way { IN  in[8]; OUT out; BUILTIN Or8Way; }`,\n      gate: logic.Or8Way\n    },\n    //\n    // ARITHMETIC\n    //\n    HalfAdder: {\n      hdl: `CHIP HalfAdder { IN  a, b; OUT sum, carry; BUILTIN HalfAdder; }`,\n      gate: arithmetic.HalfAdder\n    },\n    FullAdder: {\n      hdl: `CHIP FullAdder { IN  a, b, c; OUT sum, carry; BUILTIN FullAdder; }`,\n      gate: arithmetic.FullAdder\n    },\n    Add16: {\n      hdl: `CHIP Add16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Add16; }`,\n      gate: arithmetic.Add16\n    },\n    Inc16: {\n      hdl: `CHIP Inc16 { IN  in[16]; OUT out[16]; BUILTIN Inc16; }`,\n      gate: arithmetic.Inc16\n    },\n    ALU: {\n      hdl: `CHIP ALU { IN x[16], y[16], zx, nx, zy, ny, f, no; OUT out[16], zr, ng; BUILTIN ALU; }`,\n      gate: arithmetic.ALU\n    },\n    //\n    // MEMORY\n    //\n    Bit: {\n        hdl: `CHIP Bit { IN  in, load; OUT out; BUILTIN Bit; CLOCKED in, load; }`,\n        gate: memory.Bit\n    },\n    Register: {\n        hdl: `CHIP Register { IN  in[16], load; OUT out[16]; BUILTIN Register; CLOCKED in, load; }`,\n        gate: memory.Register\n    },\n    PC: {\n        hdl: `CHIP PC { IN  in[16], load, inc, reset; OUT out[16]; BUILTIN PC; CLOCKED in, load, inc, reset; }`,\n        gate: memory.PC\n    },\n    RAM8: {\n        hdl: `CHIP RAM8 { IN  in[16], load, address[3]; OUT out[16]; BUILTIN RAM8; CLOCKED in, load; }`,\n        gate: memory.RAM8\n    },\n    RAM64: {\n        hdl: `CHIP RAM64 { IN in[16], load, address[6]; OUT out[16]; BUILTIN RAM64; CLOCKED in, load; }`,\n        gate: memory.RAM64\n    },\n    RAM512: {\n        hdl: `CHIP RAM512 { IN  in[16], load, address[9]; OUT out[16]; BUILTIN RAM512; CLOCKED in, load; }`,\n        gate: memory.RAM512\n    },\n    RAM4K: {\n        hdl: `CHIP RAM4K { IN  in[16], load, address[12]; OUT out[16]; BUILTIN RAM4K; CLOCKED in, load; }`,\n        gate: memory.RAM4K\n    },\n    RAM16K: {\n        hdl: `CHIP RAM16K { IN  in[16], load, address[14]; OUT out[16]; BUILTIN RAM16K; CLOCKED in, load; }`,\n        gate: memory.RAM16K\n    },\n    //\n    // COMPUTER\n    //\n    Screen: {\n        hdl: `CHIP Screen { IN in[16], load, address[13]; OUT out[16]; BUILTIN Screen; CLOCKED in, load; }`,\n        gate: computer.Screen\n    },\n    Keyboard: {\n        hdl: `CHIP Keyboard { OUT out[16]; BUILTIN Keyboard; }`,\n        gate: computer.Keyboard\n    },\n    ROM32K: {\n        hdl: `CHIP ROM32K { IN  address[15]; OUT out[16]; BUILTIN ROM32K; }`,\n        gate: computer.ROM32K\n    },\n}\n\n","export function toBinaryString(node: Node): string {\n    return node.get().toString(2).padStart(16, \"0\")\n}\n\nexport class Node {\n    value: Uint16Array\n\n    connections: Set<Node> | null = null\n\n    constructor() {\n        this.value = new Uint16Array(1)\n    }\n\n    get() {\n      return this.value[0]\n    }\n\n    set(value: number) {\n        if (value === this.value[0]) return\n        this.value[0] = value\n        for (let connection of this.connections ?? [])\n            connection.set(this.get())\n    }\n\n    connect(node: Node) {\n        if (!this.connections) this.connections = new Set()\n        this.connections.add(node)\n    }\n\n    disconnect(node: Node) {\n        if (this.connections) this.connections.delete(node)\n    }\n}\n\nexport class SubNode extends Node {\n  mask: number\n  shiftRight: number\n\n  constructor([low, high]: SubBus) {\n    super()\n    this.mask = getMask(low, high)\n    this.shiftRight = low\n  }\n\n  set(value: number) {\n    super.set(value)\n  }\n\n  get(): number {\n    return (this.value[0] & this.mask) >>> this.shiftRight\n  }\n}\n\nexport type SubBus = [low: number, high: number]\n\nexport class SubBusListeningAdapter extends Node {\n  target: Node\n  mask: number\n  shiftLeft: number\n\n  constructor(node: Node, [low, high]: SubBus) {\n    super()\n    this.target = node\n    this.shiftLeft = low\n    this.mask = getMask(low, high)\n  }\n\n  get(): number {\n    return this.target.get()\n  }\n\n  set(value: number) {\n    const masked1 = this.target.get() & ~this.mask\n    const masked2 = (value << this.shiftLeft) & this.mask\n    this.target.set(masked1 | masked2)\n  }\n}\n\n// A helper array of powers of two\nexport const POWERS_OF_2 = [1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768]\n\nexport function getMask(low: number, high: number): number {\n  let mask = 0\n  let bitHolder = POWERS_OF_2[low]\n  for (let i=low; i<=high; i++) {\n    mask |= bitHolder\n    bitHolder = (bitHolder << 1)\n  }\n  return mask\n}\n","import { readPinsInfo } from \".\"\nimport { HDLParser } from \"../hdl/parser\"\nimport { TokenType } from \"../hdl/tokenizer\"\nimport { BuiltInGate } from \"./builtin-gate\"\nimport { builtins } from \"./builtins\"\nimport { Gate } from \"./gate\"\nimport { GateClass, PinInfo } from \"./gateclass\"\nimport { Node } from \"./node\"\n\nexport class BuiltInGateClass extends GateClass {\n  tsClassName: typeof BuiltInGate\n\n  constructor(name: string, parser: HDLParser, inputPinsInfo: PinInfo[], outputPinsInfo: PinInfo[]) {\n    super(name, inputPinsInfo, outputPinsInfo)\n    // read typescript class name\n    parser.expectPeek(TokenType.IDENTIFIER, \"Missing typescript class name\")\n    // TODO: support more than NAND\n    switch (name) {\n      // CH1\n      case \"Nand\": this.tsClassName = builtins.Nand.gate; break\n      case \"Not\": this.tsClassName = builtins.Not.gate; break\n      case \"Not16\": this.tsClassName = builtins.Not16.gate; break\n      case \"And\": this.tsClassName = builtins.And.gate; break\n      case \"And16\": this.tsClassName = builtins.And16.gate; break\n      case \"Or\": this.tsClassName = builtins.Or.gate; break\n      case \"Or16\": this.tsClassName = builtins.Or16.gate; break\n      case \"Xor\": this.tsClassName = builtins.Xor.gate; break\n      case \"Mux\": this.tsClassName = builtins.Mux.gate; break\n      case \"Mux16\": this.tsClassName = builtins.Mux16.gate; break\n      case \"Mux4Way16\": this.tsClassName = builtins.Mux4Way16.gate; break\n      case \"Mux8Way16\": this.tsClassName = builtins.Mux8Way16.gate; break\n      case \"DMux\": this.tsClassName = builtins.DMux.gate; break\n      case \"DMux4Way\": this.tsClassName = builtins.DMux4Way.gate; break\n      case \"DMux8Way\": this.tsClassName = builtins.DMux8Way.gate; break\n      case \"Or8Way\": this.tsClassName = builtins.Or8Way.gate; break\n      // CH2\n      case \"HalfAdder\": this.tsClassName = builtins.HalfAdder.gate; break\n      case \"FullAdder\": this.tsClassName = builtins.FullAdder.gate; break\n      case \"Add16\": this.tsClassName = builtins.Add16.gate; break\n      case \"Inc16\": this.tsClassName = builtins.Inc16.gate; break\n      case \"ALU\": this.tsClassName = builtins.ALU.gate; break\n      // CH3\n      case \"DFF\": this.tsClassName = builtins.DFF.gate; break // REQUIRED BUILTIN\n      case \"Bit\": this.tsClassName = builtins.Bit.gate; break\n      case \"Register\": this.tsClassName = builtins.Register.gate; break\n      case \"PC\": this.tsClassName = builtins.PC.gate; break\n      case \"RAM8\": this.tsClassName = builtins.RAM8.gate; break\n      case \"RAM64\": this.tsClassName = builtins.RAM64.gate; break\n      case \"RAM512\": this.tsClassName = builtins.RAM512.gate; break\n      case \"RAM4K\": this.tsClassName = builtins.RAM4K.gate; break\n      case \"RAM16K\": this.tsClassName = builtins.RAM16K.gate; break\n      // CH5\n      case \"Screen\": this.tsClassName = builtins.Screen.gate; break\n      case \"Keyboard\": this.tsClassName = builtins.Keyboard.gate; break\n      case \"ROM32K\": this.tsClassName = builtins.ROM32K.gate; break\n      default: parser.fail(`Unexpected gate class name ${name}`)\n    }\n    // read ';' symbol\n    parser.expectPeek(TokenType.SEMICOLON, \"Missing ';'\")\n\n    this.isInputClocked = new Array(inputPinsInfo.length)\n    this.isOutputClocked = new Array(outputPinsInfo.length)\n\n    if (parser.peekTokenIs(TokenType.CLOCKED)) {\n        this.isClocked = true\n        const clockedPins = readPinsInfo(parser)\n        for (let i=0; i<clockedPins.length; i++) {\n            let inputFound = false\n            let outputFound = false\n            for (let j=0; j<this.isInputClocked.length && !inputFound; j++) {\n                if (!this.isInputClocked[j]) {\n                    inputFound = inputPinsInfo[j].name === clockedPins[i].name\n                    this.isInputClocked[j] = inputFound\n                }\n            }\n            if (!inputFound) {\n                for (let j=0; j<this.isOutputClocked.length && !outputFound; j++) {\n                    if (!this.isOutputClocked[j]) {\n                        outputFound = outputPinsInfo[j].name === clockedPins[j].name\n                        this.isOutputClocked[j] = outputFound\n                    }\n                }\n            }\n        }\n    }\n\n    // read '}' symbol\n    parser.expectPeek(TokenType.RBRACE, \"Missing '}'\")\n  }\n\n  newInstance(): Gate {\n    const inputNodes: Node[] = this.inputPinsInfo.map((_) => new Node())\n    const outputNodes: Node[] = this.outputPinsInfo.map((_) => new Node())\n    return new this.tsClassName(inputNodes, outputNodes, this)\n  }\n}\n","import { SubBus } from \"./node\"\n\nexport enum ConnectionType {\n    FROM_INPUT = \"FROM_INPUT\",\n    TO_OUTPUT = \"TO_OUTPUT\",\n    FROM_INTERNAL = \"FROM_INTERNAL\",\n    TO_INTERNAL = \"TO_INTERNAL\",\n    FROM_TRUE = \"FROM_TRUE\",\n    FROM_FALSE = \"FROM_FALSE\",\n    INVALID = \"INVALID\"\n}\n\nexport type Connection = {\n    type: ConnectionType\n    gatePinNumber: number\n    partNumber: number\n    partPinName: string\n    gateSubBus: SubBus | null\n    partSubBus: SubBus | null\n}\n","import { Gate } from \"./gate\"\nimport { GateClass, PinType } from \"./gateclass\"\nimport { Node } from \"./node\"\n\nexport class CompositeGate extends Gate {\n  parts: Gate[]\n  internalPins: Node[]\n\n  constructor(inputPins: Node[], outputPins: Node[], internalPins: Node[], gateClass: GateClass, parts: Gate[]) {\n    super(inputPins, outputPins, gateClass)\n    this.internalPins = internalPins\n    this.parts = parts\n  }\n\n  reCompute() {\n    for (let part of this.parts) part.eval()\n  }\n\n  clockUp() {\n    if (this.gateClass.isClocked) {\n      for (const part of this.parts) {\n        part.tock()\n      }\n    }\n  }\n\n  clockDown() {\n    if (this.gateClass.isClocked)\n      for (const part of this.parts) part.tick()\n  }\n\n  getNode(name: string): Node | null {\n    const result = super.getNode(name)\n    if (!result) {\n      const type = this.gateClass.getPinType(name)\n      const index = this.gateClass.getPinNumber(name)\n      if (type === PinType.INTERNAL) return this.internalPins[index]\n    }\n    return result\n  }\n}\n","import { Connection, ConnectionType } from \"./connection\"\nimport { Gate } from \"./gate\"\nimport { GateClass, PinInfo, PinType } from \"./gateclass\"\nimport { Node, SubNode, SubBus, SubBusListeningAdapter } from \"./node\"\nimport { HDLParser } from \"./../hdl/parser\"\nimport { TokenType } from \"./../hdl/tokenizer\"\nimport { CompositeGate } from \"./composite-gate\"\nimport { getGateClass } from \".\"\n\nexport type Name = string\nexport type Content = string\nexport type UserDefinedParts = Map<string, string>\n\nexport class CompositeGateClass extends GateClass {\n  partsList: GateClass[]\n  internalPinsInfo: PinInfo[]\n  connections: Set<Connection>\n\n  constructor(name: string,\n              parser: HDLParser,\n              inputPinsInfo: PinInfo[],\n              outputPinsInfo: PinInfo[],\n              userDefinedParts: UserDefinedParts) {\n    super(name, inputPinsInfo, outputPinsInfo)\n    this.partsList = []\n    this.internalPinsInfo = []\n    this.connections = new Set()\n    this.readParts(parser, userDefinedParts)\n  }\n\n  newInstance(): Gate {\n    const parts: Gate[] = this.partsList.map((partClass) => partClass.newInstance())\n\n    const inputNodes = this.inputPinsInfo.map((_) => new Node())\n    const outputNodes = this.outputPinsInfo.map((_) => new Node())\n    const internalNodes = this.internalPinsInfo.map((_) => new Node())\n\n    const internalConnections = new Set<Connection>()\n\n    // First scan\n    let partNode: Node | null = null\n    let gateSubBus: SubBus | null = null\n    let partSubBus: SubBus | null = null\n    for (const connection of this.connections) {\n      partNode = parts[connection.partNumber].getNode(connection.partPinName)\n      if (!partNode) continue\n      gateSubBus = connection.gateSubBus\n      partSubBus = connection.partSubBus\n\n      switch (connection.type) {\n        case ConnectionType.FROM_INPUT:\n          this.connectGateToPart(inputNodes[connection.gatePinNumber], gateSubBus, partNode, partSubBus)\n          break\n        case ConnectionType.TO_OUTPUT:\n          this.connectGateToPart(partNode, partSubBus, outputNodes[connection.gatePinNumber], gateSubBus)\n          break\n        case ConnectionType.TO_INTERNAL:\n          const target = partSubBus === null ? new Node() : new SubNode(partSubBus)\n          partNode.connect(target)\n          internalNodes[connection.gatePinNumber] = target\n          break\n        case ConnectionType.FROM_INTERNAL:\n        case ConnectionType.FROM_TRUE:\n        case ConnectionType.FROM_FALSE:\n          internalConnections.add(connection)\n          break\n      }\n    }\n\n    // Second scan\n    let subNode: SubNode\n    for (const connection of internalConnections) {\n      partNode = parts[connection.partNumber].getNode(connection.partPinName)\n      if (!partNode) continue\n      gateSubBus = connection.gateSubBus\n      partSubBus = connection.partSubBus\n\n      switch (connection.type) {\n        case ConnectionType.FROM_INTERNAL:\n          const source = internalNodes[connection.gatePinNumber]\n          if (!partSubBus) {\n            source.connect(partNode)\n          } else {\n            const node = new SubBusListeningAdapter(partNode, partSubBus)\n            source.connect(node)\n          }\n          break\n        case ConnectionType.FROM_TRUE:\n          if (!gateSubBus) HDLParser.fail(\"gateSubBus is null\")\n          subNode = new SubNode(gateSubBus)\n          subNode.set(1)\n          if (!partSubBus) {\n            partNode.set(subNode.get())\n          } else {\n            const node = new SubBusListeningAdapter(partNode, partSubBus)\n            node.set(subNode.get())\n          }\n          break\n        case ConnectionType.FROM_FALSE:\n          if (!gateSubBus) HDLParser.fail(\"gateSubBus is null\")\n          subNode = new SubNode(gateSubBus)\n          subNode.set(0)\n          if (!partSubBus) {\n            partNode.set(subNode.get())\n          } else {\n            const node = new SubBusListeningAdapter(partNode, partSubBus)\n            node.set(subNode.get())\n          }\n          break\n      }\n    }\n\n    return new CompositeGate(inputNodes, outputNodes, internalNodes, this, parts)\n  }\n\n  connectGateToPart(sourceNode: Node, sourceSubBus: SubBus | null, targetNode: Node, targetSubBus: SubBus | null) {\n    let target = targetNode\n    if (targetSubBus) {\n      target = new SubBusListeningAdapter(target, targetSubBus)\n    }\n    if (!sourceSubBus) {\n      sourceNode.connect(target)\n    } else {\n      const subNode = new SubNode(sourceSubBus)\n      sourceNode.connect(subNode)\n      subNode.connect(target)\n    }\n  }\n\n  readParts(parser: HDLParser, userDefinedParts: UserDefinedParts) {\n    let endOfParts = false\n    while (parser.hasMoreTokens() && !endOfParts) {\n      // check if end of hdl\n      if (parser.peekTokenIs(TokenType.RBRACE)) {\n        // read }\n        parser.advance()\n        endOfParts = true\n      } else {\n        // read partName\n        parser.expectPeek(TokenType.IDENTIFIER, \"A GateClass name is expected\")\n        const partName = parser.token.literal ?? ''\n        // make part\n        const gateClass = getGateClass(partName, userDefinedParts)\n        const partNumber = this.partsList.length\n        this.partsList.push(gateClass)\n        this.isClocked = this.isClocked || gateClass.isClocked\n        // read (\n        parser.expectPeek(TokenType.LPAREN, \"Missing '('\")\n        // read pins\n        this.readPinNames(parser, partName, partNumber)\n        // read ;\n        parser.expectPeek(TokenType.SEMICOLON, \"Missing ';'\")\n      }\n    }\n    if (!endOfParts) parser.fail(\"Missing '}'\")\n    // read EOF\n    parser.expectPeek(TokenType.EOF, \"Expected EOF after '}'\")\n  }\n\n  readSubBus(parser: HDLParser): SubBus {\n    // read low\n    parser.expectPeek(TokenType.INT, \"Missing bus\")\n    const low = parseInt(parser.token.literal ?? \"\")\n    let high = low\n    if (parser.peekTokenIs(TokenType.DOT)) {\n      // read .\n      parser.advance()\n      // read .\n      parser.expectPeek(TokenType.DOT, \"Expected '..'\")\n      // read high\n      parser.expectPeek(TokenType.INT, \"Expected high sub bus\")\n      high = parseInt(parser.token.literal ?? \"\")\n    }\n    return [low, high]\n  }\n\n  readPinNames(parser: HDLParser, partName: string, partNumber: number): void | never {\n    let endOfPins = false\n    // read pin names\n    while (parser.hasMoreTokens() && !endOfPins) {\n      // read left pin name\n      parser.expectPeek(TokenType.IDENTIFIER, \"A pin name is expected\")\n      const leftName = parser.token.literal ?? \"\"\n      // read left sub bus\n      let leftSubBus: SubBus | null = null\n      if (parser.peekTokenIs(TokenType.LBRACKET)) {\n        // read [\n        parser.advance()\n        leftSubBus = this.readSubBus(parser)\n        // read ]\n        parser.expectPeek(TokenType.RBRACKET, \"Missing ']'\")\n      }\n\n      // read =\n      parser.expectPeek(TokenType.EQUAL, \"Missing '='\")\n      // read right pin name\n      const rightPinPossibilities = [TokenType.IDENTIFIER, TokenType.TRUE, TokenType.FALSE]\n      parser.expectPeekOneOf(rightPinPossibilities, \"A pin name, true, or false is expected\")\n      const rightName = parser.token.literal ?? \"\"\n      // read right sub bus\n      let rightSubBus: SubBus | null = null\n      if (parser.peekTokenIs(TokenType.LBRACKET)) {\n        // read [\n        parser.advance()\n        rightSubBus = this.readSubBus(parser)\n        // read ]\n        parser.expectPeek(TokenType.RBRACKET, \"Missing ']'\")\n      }\n\n      // make connection\n      this.addConnection(parser, partName, partNumber, leftName, rightName, rightSubBus, leftSubBus)\n\n      // read , or )\n      if (parser.peekTokenIs(TokenType.RPAREN)) {\n        endOfPins = true\n      } else if (!parser.peekTokenIs(TokenType.COMMA)) {\n        parser.fail(\"Missing ',' or ')'\")\n      }\n      parser.advance()\n    }\n\n    if (!endOfPins) parser.fail(\"Unexpected EOF\")\n  }\n\n  getPinInfo(type: PinType, number: number): PinInfo | null {\n    if (type === PinType.INTERNAL && number < this.internalPinsInfo.length) {\n      return this.internalPinsInfo[number]\n    } else {\n      return super.getPinInfo(type, number)\n    }\n  }\n\n  addConnection(parser: HDLParser, partName: string, partNumber: number, leftName: string, rightName: string, rightSubBus: SubBus | null, leftSubBus: SubBus | null): void | never {\n    const partGateClass = this.partsList[partNumber]\n\n    const leftType = partGateClass.getPinType(leftName)\n    if (leftType === PinType.UNKNOWN) parser.fail(`${leftName} is not a pin in ${partName}`)\n    const leftNumber = partGateClass.getPinNumber(leftName)\n    const leftPinInfo = partGateClass.getPinInfo(leftType, leftNumber)\n    const leftWidth = (leftSubBus ? leftSubBus[1] - leftSubBus[0] + 1 : leftPinInfo?.width) ?? 0\n\n    let rightType = PinType.UNKNOWN\n    let rightNumber: number = 0\n    let rightPinInfo: PinInfo | null\n\n    let selfFittingWidth = false\n\n    let connectionType: ConnectionType = ConnectionType.INVALID\n\n    if (rightName === TokenType.TRUE) {\n      rightPinInfo = { name: rightName, width: 16 }\n      connectionType = ConnectionType.FROM_TRUE\n      selfFittingWidth = true\n    } else if (rightName === TokenType.FALSE) {\n      rightPinInfo = { name: rightName, width: 16 }\n      connectionType = ConnectionType.FROM_TRUE\n      selfFittingWidth = true\n    } else {\n      rightType = this.getPinType(rightName)\n      if (rightType === PinType.UNKNOWN) {\n        rightType = PinType.INTERNAL\n        rightPinInfo = { name: rightName, width: leftWidth }\n        rightNumber = this.internalPinsInfo.length\n        this.internalPinsInfo.push(rightPinInfo)\n        this.registerPin(rightPinInfo, PinType.INTERNAL, rightNumber)\n      } else {\n        rightNumber = this.getPinNumber(rightName)\n        rightPinInfo = this.getPinInfo(rightType, rightNumber)\n      }\n    }\n\n    let rightWidth = (rightSubBus ? rightSubBus[1] - rightSubBus[0] + 1 : rightPinInfo?.width) ?? 1\n    if (selfFittingWidth) {\n      rightWidth = leftWidth\n      rightSubBus = [0, rightWidth-1]\n    }\n\n    // check that leftWidth and rightWidth are the same\n    if (leftWidth !== rightWidth)\n      parser.fail(`${leftName}(${leftWidth}) and ${rightName}(${rightWidth}) have different bus widths`)\n\n\n    switch (leftType) {\n      case PinType.INPUT:\n        switch (rightType) {\n          case PinType.INPUT:\n            connectionType = ConnectionType.FROM_INPUT\n            break\n          case PinType.INTERNAL:\n            connectionType = ConnectionType.FROM_INTERNAL\n            break\n          case PinType.OUTPUT:\n            parser.fail(\"Can't connect gate's output pin to part\")\n        }\n        break\n      case PinType.OUTPUT:\n        switch (rightType) {\n          case PinType.OUTPUT:\n            connectionType = ConnectionType.TO_OUTPUT\n            break\n          case PinType.INTERNAL:\n            connectionType = ConnectionType.TO_INTERNAL\n            break\n          case PinType.INPUT:\n            parser.fail(\"Can't connect part's output pin to gate's input pin\")\n        }\n        break\n    }\n\n    this.connections.add({\n      type: connectionType,\n      gatePinNumber: rightNumber,\n      partNumber,\n      partPinName: leftName,\n      gateSubBus: rightSubBus,\n      partSubBus: leftSubBus,\n    })\n  }\n}\n","import { HDLParser } from \"../hdl/parser\";\nimport { HDLTokenizer, TokenType } from \"../hdl/tokenizer\";\nimport { BuiltInGateClass } from \"./builtin-gateclass\";\nimport { builtins } from \"./builtins\";\nimport { CompositeGateClass, UserDefinedParts } from \"./composite-gateclass\";\nimport { GateClass, PinInfo } from \"./gateclass\";\n\nexport function getGateClass(name: string, userDefinedParts: UserDefinedParts): GateClass | never {\n  const hdlFileName = `${name}.hdl`\n  if (userDefinedParts.has(hdlFileName)) {\n    const hdl = userDefinedParts.get(hdlFileName) ?? \"\"\n    return getGateClassHDL(hdl, userDefinedParts)\n  } else {\n    return getGateClassBuiltIn(name, userDefinedParts)\n  }\n}\n\nexport function getGateClassHDL(hdl: string, userDefinedParts: UserDefinedParts): GateClass | never {\n    const tokenizer = new HDLTokenizer(hdl)\n    const parser = new HDLParser(tokenizer)\n    return readHDL(parser, userDefinedParts)\n}\n\nexport function getGateClassBuiltIn(name: string, userDefinedParts: UserDefinedParts): GateClass | never {\n    let hdl: string\n    switch (name) {\n        // CH1\n        case \"Nand\": hdl = builtins.Nand.hdl; break\n        case \"Not\": hdl = builtins.Not.hdl; break\n        case \"Not16\": hdl = builtins.Not16.hdl; break\n        case \"And\": hdl = builtins.And.hdl; break\n        case \"And16\": hdl = builtins.And16.hdl; break\n        case \"Or\": hdl = builtins.Or.hdl; break\n        case \"Or16\": hdl = builtins.Or16.hdl; break\n        case \"Xor\": hdl = builtins.Xor.hdl; break\n        case \"Mux\": hdl = builtins.Mux.hdl; break\n        case \"Mux16\": hdl = builtins.Mux16.hdl; break\n        case \"Mux4Way16\": hdl = builtins.Mux4Way16.hdl; break\n        case \"Mux8Way16\": hdl = builtins.Mux8Way16.hdl; break\n        case \"DMux\": hdl = builtins.DMux.hdl; break\n        case \"DMux4Way\": hdl = builtins.DMux4Way.hdl; break\n        case \"DMux8Way\": hdl = builtins.DMux8Way.hdl; break\n        case \"Or8Way\": hdl = builtins.Or8Way.hdl; break\n        // CH2\n        case \"HalfAdder\": hdl = builtins.HalfAdder.hdl; break\n        case \"FullAdder\": hdl = builtins.FullAdder.hdl; break\n        case \"Add16\": hdl = builtins.Add16.hdl; break\n        case \"Inc16\": hdl = builtins.Inc16.hdl; break\n        case \"ALU\": hdl = builtins.ALU.hdl; break\n        // CH3\n        case \"DFF\": hdl = builtins.DFF.hdl; break\n        case \"Bit\": hdl = builtins.Bit.hdl; break\n        case \"Register\": hdl = builtins.Register.hdl; break\n        case \"PC\": hdl = builtins.PC.hdl; break\n        case \"RAM8\": hdl = builtins.RAM8.hdl; break\n        case \"RAM64\": hdl = builtins.RAM64.hdl; break\n        case \"RAM512\": hdl = builtins.RAM512.hdl; break\n        case \"RAM4K\": hdl = builtins.RAM4K.hdl; break\n        case \"RAM16K\": hdl = builtins.RAM16K.hdl; break\n        // CH5\n        case \"Screen\": hdl = builtins.Screen.hdl; break\n        case \"Keyboard\": hdl = builtins.Keyboard.hdl; break\n        case \"ROM32K\": hdl = builtins.ROM32K.hdl; break\n        default: HDLParser.fail(`Invalid builtin gate class name: ${name}`)\n    }\n    return getGateClassHDL(hdl, userDefinedParts)\n}\n\nexport function readHDL(parser: HDLParser, userDefinedParts: UserDefinedParts): GateClass | never {\n  // read CHIP keyword\n  parser.expectCurrent(TokenType.CHIP, `Missing 'CHIP' keyword`)\n  // read gate name\n  parser.expectPeek(TokenType.IDENTIFIER, \"Missing chip name\")\n  const gateName = parser.token.literal ?? \"\"\n  // read {\n  parser.expectPeek(TokenType.LBRACE, \"Missing '{'\")\n  // read IN keyword\n  const inputPinsInfo = parser.peekTokenIs(TokenType.IN) ? readPinsInfo(parser) : []\n  // read OUT keyword\n  const outputPinsInfo = parser.peekTokenIs(TokenType.OUT) ? readPinsInfo(parser) : []\n\n  // read BUILTIN or PARTS\n  parser.advance()\n  if (parser.tokenIs(TokenType.BUILTIN)) {\n    return new BuiltInGateClass(gateName, parser, inputPinsInfo, outputPinsInfo)\n  } else if (parser.tokenIs(TokenType.PARTS)) {\n    // read :\n    parser.expectPeek(TokenType.COLON, \"Missing ':'\")\n    return new CompositeGateClass(gateName, parser, inputPinsInfo, outputPinsInfo, userDefinedParts)\n  } else {\n    return parser.fail(\"'PARTS' or 'BUILTIN' keyword expected\")\n  }\n}\n\nexport function readPinsInfo(parser: HDLParser): PinInfo[] {\n  let pinInfos: PinInfo[] = []\n  let exit = false\n\n  parser.advance()\n  while (parser.hasMoreTokens() && !exit) {\n    // check ';' symbol\n    if (parser.tokenIs(TokenType.SEMICOLON)) {\n      exit = true\n    } else {\n      // read pin name\n      parser.expectPeek(TokenType.IDENTIFIER, `Missing pin name, found ${parser.peek.literal}`)\n      const pinName = parser.token.literal ?? \"\"\n      // read width or separator\n      let pinWidth = 1\n      if (parser.peekTokenIs(TokenType.LBRACKET)) {\n        // read [\n        parser.advance()\n        // read width\n        parser.expectPeek(TokenType.INT, \"Missing width\")\n        pinWidth = parseInt(parser.token.literal ?? \"\")\n        // read ]\n        parser.expectPeek(TokenType.RBRACKET, \"Missing ']'\")\n      }\n\n      pinInfos.push({ name: pinName, width: pinWidth })\n      // check separator\n      parser.expectPeekOneOf([TokenType.COMMA, TokenType.SEMICOLON], \"Missing ',' or ';'\")\n    }\n  }\n\n  if (!exit) parser.fail(\"Unexpected EOF\")\n\n  return pinInfos\n}\n\n\n","import { getGateClass } from \"../gates\"\nimport { UserDefinedParts } from \"../gates/composite-gateclass\"\nimport { Gate } from \"../gates/gate\"\n\nexport class HardwareSimulator {\n    gate: Gate | null\n    clockUp: boolean\n\n    constructor() {\n        this.gate = null\n        this.clockUp = false\n    }\n\n    loadGate(name: string, userDefinedParts: UserDefinedParts) {\n        this.gate = getGateClass(name, userDefinedParts).newInstance()\n    }\n\n    step() {\n        if (this.clockUp) {\n            this.performTock()\n        } else {\n            this.performTick()\n        }\n    }\n\n    performTock() {\n        if (this.gate === null) return\n\n        this.gate.tock()\n        this.clockUp = false\n    }\n\n    performTick() {\n        if (this.gate === null) return\n\n        this.gate.tick()\n        this.clockUp = true\n    }\n\n    setInputPin(pinNumber: number, value: number) {\n        this.gate?.inputPins[pinNumber].set(value)\n    }\n}\n","export type TestScriptProps = {\n  script: string | null\n}\n\nexport function TestScript({ script }: TestScriptProps) {\n  return (<div className=\"testScript\"><pre>{script}</pre></div>)\n}\n","import React, { useCallback, useEffect, useRef, useState } from \"react\"\nimport { CompositeGate } from \"./../../gates/composite-gate\"\nimport { CompositeGateClass, UserDefinedParts } from \"./../../gates/composite-gateclass\"\nimport { PinInfo, PinType } from \"./../../gates/gateclass\"\nimport { Actions } from \"./actions\"\nimport { HDLViewer } from \"./hdl-viewer\"\nimport { Pins } from \"./pins\"\nimport { StatusMessage } from \"./status-message\"\nimport { HardwareSimulator } from \"../../simulators/hardware-simulator\"\nimport { Gate } from \"../../gates/gate\"\nimport { TestScript } from \"./test-script\"\n\nexport type PinUpdate = {\n  value: string\n  number: number\n  type: PinType\n}\n\nexport type PinData = {\n  name: string\n  value: string\n}\n\nexport type AllPinData = {\n  input: PinData[],\n  output: PinData[],\n  internal: PinData[]\n}\n\nexport default function HardwareSimulatorUI() {\n  const [gateFilename, setGateFilename] = useState<string | null>(null)\n  const [userDefinedParts, setUserDefinedParts] = useState<UserDefinedParts | null>(null)\n  const [testScripts, setTestScripts] = useState<Map<string, string> | null>(null)\n  const [testScript, setTestScript] = useState<string | null>(\"default\")\n\n  const [pinData, setPinData] = useState<AllPinData>({ input: [], output: [], internal: [] })\n  const [status, setStatus] = useState<string | null>(null)\n\n  const [format, setFormat] = useState<string>(\"decimal\")\n\n  const simulator = useRef(new HardwareSimulator())\n\n  // update UI\n  const updatePinData = useCallback(() => {\n    const gate = simulator.current.gate\n    if (!gate) {\n      throw new Error(\"updatePinData: gate can not be null\")\n    }\n    const input = getPinData(gate, PinType.INPUT)\n    const output = getPinData(gate, PinType.OUTPUT)\n    const internal = getPinData(gate, PinType.INTERNAL)\n    setPinData({ input, output, internal })\n  }, [])\n\n  // parse hdl file contents into gate\n  useEffect(() => {\n    if (!gateFilename || !userDefinedParts) { return }\n    if (!gateFilename.endsWith(\".hdl\")) { return }\n    const gateName = gateFilename.slice(0, -4)\n    try {\n      simulator.current.loadGate(gateName, userDefinedParts)\n      updatePinData()\n      setStatus(\"Loaded successfully!\")\n      console.log(simulator.current.gate)\n    } catch (error) {\n      setStatus(`${error}`)\n    }\n  }, [gateFilename, userDefinedParts, updatePinData])\n\n  // step forward one time unit\n  const singleStep = useCallback(() => {\n    simulator.current.step()\n    updatePinData()\n  }, [updatePinData])\n\n  // set input pin\n  const updateInputPin = useCallback(({ value, number, type }: PinUpdate) => {\n    // can only update input pins\n    if (type !== PinType.INPUT) { return }\n    simulator.current.setInputPin(number, parseInt(value) || 0)\n    updatePinData()\n  }, [updatePinData])\n\n  let hdl = \"No hdl file\"\n  if (userDefinedParts && gateFilename) {\n    hdl = userDefinedParts.get(gateFilename) ?? \"\"\n  }\n\n  testScripts?.set(\"default\", \"repeat {\\n    tick,\\n    tock;\\n}\")\n  const displayScript = (testScript ? testScripts?.get(testScript) : null) ?? \"No test found\"\n\n  return (\n    <div id=\"hardwareSimulator\">\n      <div className=\"header\">\n        <h1>HardwareSimulator</h1>\n      </div>\n      <Actions\n        hdlFileName={gateFilename}\n        setHDLFileName={setGateFilename}\n        userDefinedParts={userDefinedParts}\n        setUserDefinedParts={setUserDefinedParts}\n        testScript={testScript}\n        setTestScript={setTestScript}\n        testScripts={testScripts}\n        setTestScripts={setTestScripts}\n        setFormat={setFormat}\n        singleStep={singleStep} />\n      <div className=\"container\">\n        <Pins title=\"Input Pins\" type={PinType.INPUT} pinData={pinData.input} updatePin={updateInputPin} format={format} />\n        <Pins title=\"Output Pins\" type={PinType.OUTPUT} pinData={pinData.output} updatePin={updateInputPin} format={format} />\n        <TestScript script={displayScript} />\n        <HDLViewer hdl={hdl} />\n        <Pins title=\"Internal Pins\" type={PinType.INTERNAL} pinData={pinData.internal} updatePin={updateInputPin} format={format} />\n      </div>\n      <StatusMessage status={status} />\n    </div>\n  )\n}\n\nexport function getPinData(gate: Gate, pinType: PinType): PinData[] {\n  let pinInfo: PinInfo[] = []\n  switch (pinType) {\n    case PinType.INPUT:\n      pinInfo = gate.gateClass.inputPinsInfo\n      return gate.inputPins.map((node, i) => ({name: pinInfo[i].name, value: node.value[0].toString()}))\n    case PinType.OUTPUT:\n      pinInfo = gate.gateClass.outputPinsInfo\n      return gate.outputPins.map((node, i) => ({name: pinInfo[i].name, value: node.value[0].toString()}))\n    case PinType.INTERNAL:\n      const compositeGate = gate as CompositeGate\n      if (!compositeGate) return []\n      const compositeClass = compositeGate.gateClass as CompositeGateClass\n      if (!compositeClass) return []\n      pinInfo = compositeClass.internalPinsInfo\n      return compositeGate.internalPins.map((node, i) => ({name: pinInfo[i].name, value: node.value[0].toString()}))\n  }\n  throw new Error(`pinType is ${pinType}`)\n}\n","import React from 'react'\nimport './App.css'\nimport HardwareSimulatorUI from './hack/guis/hardware-simulator'\n\nexport default function App() {\n  return (\n    <div className=\"App\">\n      <HardwareSimulatorUI />\n    </div>\n  )\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}