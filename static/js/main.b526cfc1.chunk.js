(this["webpackJsonpnand2tetris-online"]=this["webpackJsonpnand2tetris-online"]||[]).push([[0],{23:function(t,e,i){},24:function(t,e,i){},27:function(t,e,i){"use strict";i.r(e);var n,a=i(5),s=i.n(a),r=i(17),u=i.n(r),c=(i(23),i(24),i(7)),o=i(0),l=i(1);!function(t){t.INPUT="INPUT",t.OUTPUT="OUTPUT",t.INTERNAL="INTERNAL",t.UNKNOWN="UNKNOWN"}(n||(n={}));var h=function(){function t(e,i,a){Object(o.a)(this,t),this.namesToTypes=void 0,this.namesToNumbers=void 0,this.name=void 0,this.inputPinsInfo=void 0,this.outputPinsInfo=void 0,this.isClocked=void 0,this.isInputClocked=void 0,this.isOutputClocked=void 0,this.name=e,this.namesToTypes={},this.namesToNumbers={},this.inputPinsInfo=i,this.registerPins(i,n.INPUT),this.outputPinsInfo=a,this.registerPins(a,n.OUTPUT),this.isClocked=!1,this.isInputClocked=[],this.isOutputClocked=[]}return Object(l.a)(t,[{key:"getPinInfo",value:function(t,e){switch(t){case n.INPUT:if(e<this.inputPinsInfo.length)return this.inputPinsInfo[e];break;case n.OUTPUT:if(e<this.outputPinsInfo.length)return this.outputPinsInfo[e]}return null}},{key:"getPinType",value:function(t){var e;return null!==(e=this.namesToTypes[t])&&void 0!==e?e:n.UNKNOWN}},{key:"getPinNumber",value:function(t){var e;return null!==(e=this.namesToNumbers[t])&&void 0!==e?e:-1}},{key:"registerPins",value:function(t,e){var i=this;t.forEach((function(t,n){i.registerPin(t,e,n)}))}},{key:"registerPin",value:function(t,e,i){this.namesToTypes[t.name]=e,this.namesToNumbers[t.name]=i}}]),t}(),d=i(15),p=i.n(d),v=i(18),f=i(4);function O(t){var e,i,n=t.hdlFilename,s=t.setHDLFileName,r=t.userWorkspace,u=t.setUserWorkspace,c=t.testScript,o=t.setTestScript,l=t.singleStep,h=t.setFormat,d=Object(a.useCallback)(function(){var t=Object(v.a)(p.a.mark((function t(e){var i,n,a,r,c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.target.files){t.next=3;break}throw new Error("no files found");case 3:n=new Map,r=0;case 5:if(!(r<i.length)){t.next=17;break}return(c=i[r]).name.endsWith(".hdl")&&!a&&(a=c),t.t0=n,t.t1=c.name,t.next=12,c.text();case 12:t.t2=t.sent,t.t0.set.call(t.t0,t.t1,t.t2);case 14:r++,t.next=5;break;case 17:u(n),a&&s(a.name);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[s,u]),O=Array.from(null!==(e=null===r||void 0===r?void 0:r.keys())&&void 0!==e?e:[]).filter((function(t){return t.endsWith(".tst")})),k=Array.from(null!==(i=null===r||void 0===r?void 0:r.keys())&&void 0!==i?i:[]).filter((function(t){return t.endsWith(".hdl")}));return Object(f.jsxs)("div",{className:"actions",children:[Object(f.jsx)("input",{type:"file",webkitdirectory:"",directory:"",mozdirectory:"",onChange:d}),Object(f.jsx)("select",{value:null!==n&&void 0!==n?n:void 0,onChange:function(t){return s(t.target.value)},children:k.map((function(t){return Object(f.jsx)("option",{value:t,children:t},t)}))}),Object(f.jsx)("select",{value:null!==c&&void 0!==c?c:void 0,onChange:function(t){return o(t.target.value)},children:O.map((function(t){return Object(f.jsx)("option",{value:t,children:t},t)}))}),Object(f.jsxs)("select",{onChange:function(t){return h(t.target.value)},children:[Object(f.jsx)("option",{value:"decimal",children:"Decimal"},"decimal"),Object(f.jsx)("option",{value:"binary",children:"Binary"},"binary"),Object(f.jsx)("option",{value:"hexadecimal",children:"Hexadecimal"},"hexadecimal")]}),Object(f.jsx)("button",{onClick:l,children:"Single Step"})]})}function k(t){var e=t.hdl;return Object(f.jsx)("div",{className:"hdlViewer",children:Object(f.jsx)("pre",{children:e})})}function b(t){var e=t.title,i=t.type,s=t.pinData,r=t.updatePin,u=t.format,c=Object(a.useCallback)((function(t,e,i){r({value:t,number:e,type:i})}),[r]);return Object(f.jsxs)("div",{className:"pins",children:[Object(f.jsx)("h3",{children:e}),Object(f.jsx)("table",{children:Object(f.jsx)("tbody",{children:s.map((function(t,e){var a=t.name,s=t.value,r=i===n.INPUT?s:function(t,e){var i,n=null!==(i=parseInt(t))&&void 0!==i?i:0;switch(e){case"binary":return n.toString(2);case"hexadecimal":return n.toString(16);default:return n.toString()}}(s,u);return Object(f.jsxs)("tr",{children:[Object(f.jsx)("td",{children:a}),Object(f.jsx)("td",{children:Object(f.jsx)("input",{value:r,onChange:function(t){return c(t.target.value,e,i)}})})]},e)}))})})]})}function I(t){var e=t.status;return Object(f.jsx)("div",{className:"statusMessage",children:e})}var g,m=i(16),P=i(2),T=i(3),N=i(12);!function(t){t.IDENTIFIER="IDENTIFIER",t.TRUE="true",t.FALSE="false",t.CHIP="CHIP",t.IN="IN",t.OUT="OUT",t.PARTS="PARTS",t.BUILTIN="BUILTIN",t.CLOCKED="CLOCKED",t.INT="INT",t.LBRACE="LBRACE",t.RBRACE="RBRACE",t.LBRACKET="LBRACKET",t.RBRACKET="RBRACKET",t.LPAREN="LPAREN",t.RPAREN="RPAREN",t.COLON="COLON",t.EQUAL="EQUAL",t.COMMA="COMMA",t.SEMICOLON="SEMICOLON",t.DOT="DOT",t.INVALID="INVALID",t.EOF="EOF"}(g||(g={}));var C=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return i}(Object(N.a)(Error)),y=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.readpos=void 0,this.pos=void 0,this.cur=void 0,this.keywords=void 0,this.token={type:null,literal:null},this.input=e,this.readpos=0,this.pos=0,this.cur="",this.keywords={CHIP:g.CHIP,IN:g.IN,OUT:g.OUT,PARTS:g.PARTS,BUILTIN:g.BUILTIN,CLOCKED:g.CLOCKED,true:g.TRUE,false:g.FALSE},this.readChar()}return Object(l.a)(t,[{key:"hasMoreTokens",value:function(){return this.token.type!==g.EOF}},{key:"advance",value:function(){switch(this.skipWhitespaceAndComments(),this.token.literal=this.cur,this.cur){case"{":this.token.type=g.LBRACE;break;case"}":this.token.type=g.RBRACE;break;case"(":this.token.type=g.LPAREN;break;case")":this.token.type=g.RPAREN;break;case"[":this.token.type=g.LBRACKET;break;case"]":this.token.type=g.RBRACKET;break;case"=":this.token.type=g.EQUAL;break;case",":this.token.type=g.COMMA;break;case".":this.token.type=g.DOT;break;case":":this.token.type=g.COLON;break;case";":this.token.type=g.SEMICOLON;break;case"":this.token.type=g.EOF;break;default:if(j(this.cur)){var t=this.readIdentifier();return this.token.type=this.lookupIdentifier(t),void(this.token.literal=t)}if(A(this.cur))return this.token.type=g.INT,void(this.token.literal=this.readNumber())}this.readChar()}},{key:"fail",value:function(e){t.fail(e)}},{key:"lookupIdentifier",value:function(t){var e;return null!==(e=this.keywords[t])&&void 0!==e?e:g.IDENTIFIER}},{key:"readIdentifier",value:function(){for(var t=this.pos;j(this.cur)||A(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readNumber",value:function(){for(var t=this.pos;A(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readChar",value:function(){this.cur=this.readpos>=this.input.length?"":this.input[this.readpos],this.pos=this.readpos,this.readpos++}},{key:"peekChar",value:function(){return this.readpos>=this.input.length?"":this.input[this.readpos]}},{key:"skipWhitespaceAndComments",value:function(){for(var t=!1,e=!1;;){var i=this.peekChar();if("/"===this.cur&&"/"===i)t=!0,this.readChar();else if(t&&"\n"===this.cur)t=!1;else if("/"===this.cur&&"*"===i)e=!0,this.readChar();else if(e&&"*"===this.cur&&"/"===i)e=!1,this.readChar();else if(!t&&!e&&" "!==this.cur&&"\t"!==this.cur&&"\n"!==this.cur&&"\r"!==this.cur)return;this.readChar()}}}],[{key:"fail",value:function(t){throw new C(t)}}]),t}();function j(t){var e=t.charCodeAt(0);return e>=65&&e<91||e>=97&&e<123}function A(t){var e=t.charCodeAt(0);return e>=48&&e<58}var E=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.token={literal:null,type:null},this.peek={literal:null,type:null},this.input=e,this.advance(),this.advance()}return Object(l.a)(t,[{key:"advance",value:function(){this.token=Object(m.a)({},this.peek),this.input.advance(),this.peek=Object(m.a)({},this.input.token)}},{key:"hasMoreTokens",value:function(){return!this.tokenIs(g.EOF)}},{key:"tokenIs",value:function(t){return this.token.type===t}},{key:"peekTokenIs",value:function(t){return this.peek.type===t}},{key:"expectCurrent",value:function(t,e){this.tokenIs(t)||this.fail(e)}},{key:"expectPeek",value:function(t,e){this.peekTokenIs(t)?this.advance():this.fail(e)}},{key:"expectPeekOneOf",value:function(t,e){this.peek.type&&t.includes(this.peek.type)?this.advance():this.fail(e)}},{key:"fail",value:function(t){this.input.fail(t)}}],[{key:"fail",value:function(t){y.fail(t)}}]),t}(),U=function(){function t(e,i,n){Object(o.a)(this,t),this.gateClass=void 0,this.inputPins=void 0,this.outputPins=void 0,this.inputPins=e,this.outputPins=i,this.gateClass=n}return Object(l.a)(t,[{key:"getNode",value:function(t){var e=this.gateClass.getPinType(t),i=this.gateClass.getPinNumber(t);switch(e){case n.INPUT:return this.inputPins[i];case n.OUTPUT:return this.outputPins[i]}return null}},{key:"tick",value:function(){console.log("Gate tick()"),this.doEval(),this.clockUp()}},{key:"tock",value:function(){console.log("Gate tock()"),this.clockDown(),this.doEval()}},{key:"eval",value:function(){this.doEval()}},{key:"doEval",value:function(){this.reCompute()}}]),t}(),M=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){}},{key:"clockUp",value:function(){}},{key:"clockDown",value:function(){}}]),i}(U),R=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(1-t)}}]),i}(M),L=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(~t)}}]),i}(M),x=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t&e)}}]),i}(M),w=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t^e)}}]),i}(M),S={Not:R,Not16:L,And:x,Or:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t|e)}}]),i}(M),Xor:w,Mux:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get();this.outputPins[0].set(0===i?t:e)}}]),i}(M),Mux4Way16:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get(),n=this.inputPins[3].get(),a=0;switch(this.inputPins[4].get()){case 0:a=t;break;case 1:a=e;break;case 2:a=i;break;case 3:a=n}this.outputPins[0].set(a)}}]),i}(M),Mux8Way16:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get(),n=this.inputPins[3].get(),a=this.inputPins[4].get(),s=this.inputPins[5].get(),r=this.inputPins[6].get(),u=this.inputPins[7].get(),c=0;switch(this.inputPins[8].get()){case 0:c=t;break;case 1:c=e;break;case 2:c=i;break;case 3:c=n;break;case 4:c=a;break;case 5:c=s;break;case 6:c=r;break;case 7:c=u}this.outputPins[0].set(c)}}]),i}(M),DMux:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(0===e?0:t)}}]),i}(M),DMux4Way:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(1===e?t:0),this.outputPins[2].set(2===e?t:0),this.outputPins[3].set(3===e?t:0)}}]),i}(M),DMux8Way:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(0===e?t:0),this.outputPins[1].set(1===e?t:0),this.outputPins[2].set(2===e?t:0),this.outputPins[3].set(3===e?t:0),this.outputPins[4].set(4===e?t:0),this.outputPins[5].set(5===e?t:0),this.outputPins[6].set(6===e?t:0),this.outputPins[7].set(7===e?t:0)}}]),i}(M),Or8Way:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(0===t?0:1)}}]),i}(M)},F={HalfAdder:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t^e),this.outputPins[1].set(t&e)}}]),i}(M),FullAdder:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get()+this.inputPins[1].get()+this.inputPins[2].get();this.outputPins[0].set(t%2),this.outputPins[1].set(t/2)}}]),i}(M),Add16:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(t+e)}}]),i}(M),Inc16:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(t+1)}}]),i}(M),ALU:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.inputPins[2].get()&&(t=0),this.inputPins[3].get()&&(t=~t),this.inputPins[4].get()&&(e=0),this.inputPins[5].get()&&(e=~e);var i=1===this.inputPins[6].get()?t+e:t&e;this.inputPins[7].get()&&(i=~i),this.outputPins[0].set(i),this.outputPins[1].set(0===i?1:0),this.outputPins[2].set(i<0?1:0)}}]),i}(M)},D=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).state=void 0,s.state=0,s}return Object(l.a)(i,[{key:"clockUp",value:function(){1===this.inputPins[1].get()&&(this.state=this.inputPins[0].get())}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),i}(M),B=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).state=void 0,s.state=0,s}return Object(l.a)(i,[{key:"clockUp",value:function(){1===this.inputPins[1].get()&&(this.state=this.inputPins[0].get())}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),i}(M),W=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).value=void 0,s.value=0,s}return Object(l.a)(i,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get();1===this.inputPins[3].get()?this.value=0:1===e?this.value=t:1===i&&this.value++}},{key:"clockDown",value:function(){this.outputPins[0].set(this.value)}}]),i}(M),K=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,s){var r;return Object(o.a)(this,i),(r=e.call(this,t,n,a)).size=void 0,r.values=void 0,r.size=s,r.values=new Uint16Array(s),r}return Object(l.a)(i,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get();1===e&&(this.values[i]=t)}},{key:"clockDown",value:function(){this.reCompute()}},{key:"reCompute",value:function(){var t=this.inputPins[2].get();this.outputPins[0].set(this.values[t])}}]),i}(M),_={Bit:D,Register:B,PC:W,RAM:K,RAM8:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){return Object(o.a)(this,i),e.call(this,t,n,a,8)}return i}(K),RAM64:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){return Object(o.a)(this,i),e.call(this,t,n,a,64)}return i}(K),RAM512:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){return Object(o.a)(this,i),e.call(this,t,n,a,512)}return i}(K),RAM4K:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){return Object(o.a)(this,i),e.call(this,t,n,a,4096)}return i}(K),RAM16K:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){return Object(o.a)(this,i),e.call(this,t,n,a,16384)}return i}(K)},H=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).values=void 0,s.values=new Uint16Array(8192),s}return Object(l.a)(i,[{key:"clockUp",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get(),i=this.inputPins[2].get();1===e&&(this.values[i]=t)}},{key:"reCompute",value:function(){var t=this.inputPins[2].get();this.outputPins[0].set(this.values[t])}},{key:"clockDown",value:function(){this.reCompute()}}]),i}(M),G=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).key=void 0,s.key=-1,s}return i}(M),V=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).values=void 0,s.values=new Uint16Array(i.SIZE),s}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get();this.outputPins[0].set(this.values[t])}}]),i}(M);V.SIZE=32768;var X={Screen:H,Keyboard:G,ROM32K:V},z={Nand:{hdl:"CHIP Nand { IN  a, b; OUT out; BUILTIN Nand; }",gate:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return Object(l.a)(i,[{key:"reCompute",value:function(){var t=this.inputPins[0].get(),e=this.inputPins[1].get();this.outputPins[0].set(1-(t&e))}}]),i}(M)},DFF:{hdl:"CHIP DFF { IN  in; OUT out; BUILTIN DFF; CLOCKED in; }",gate:function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a){var s;return Object(o.a)(this,i),(s=e.call(this,t,n,a)).state=void 0,s.state=0,s}return Object(l.a)(i,[{key:"clockUp",value:function(){this.state=this.inputPins[0].get()}},{key:"clockDown",value:function(){this.outputPins[0].set(this.state)}}]),i}(M)},Not:{hdl:"CHIP Not { IN  in; OUT out; BUILTIN Not; } ",gate:S.Not},Not16:{hdl:"CHIP Not16 { IN  in[16]; OUT out[16]; BUILTIN Not16; }",gate:S.Not16},And:{hdl:"CHIP And { IN  a, b; OUT out; BUILTIN And; } ",gate:S.And},And16:{hdl:"CHIP And16 { IN  a[16], b[16]; OUT out[16]; BUILTIN And; }",gate:S.And},Or:{hdl:"CHIP Or { IN  a, b; OUT out; BUILTIN Or; }",gate:S.Or},Or16:{hdl:"CHIP Or16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Or; }",gate:S.Or},Xor:{hdl:"CHIP Xor { IN  a, b; OUT out; BUILTIN Xor; }",gate:S.Xor},Mux:{hdl:"CHIP Mux { IN  a, b, sel; OUT out; BUILTIN Mux;}",gate:S.Mux},Mux16:{hdl:"CHIP Mux16 { IN  a[16], b[16], sel; OUT out[16]; BUILTIN Mux; }",gate:S.Mux},Mux4Way16:{hdl:" CHIP Mux4Way16 { IN a[16], b[16], c[16], d[16], sel[2]; OUT out[16]; BUILTIN Mux4Way16; }",gate:S.Mux4Way16},Mux8Way16:{hdl:"CHIP Mux8Way16 { IN  a[16], b[16], c[16], d[16], e[16], f[16], g[16], h[16], sel[3]; OUT out[16]; BUILTIN Mux8Way16; }",gate:S.Mux8Way16},DMux:{hdl:"CHIP DMux { IN  in, sel; OUT a, b; BUILTIN DMux; }",gate:S.DMux},DMux4Way:{hdl:"CHIP DMux4Way { IN  in, sel[2]; OUT a, b, c, d; BUILTIN DMux4Way; }",gate:S.DMux4Way},DMux8Way:{hdl:"CHIP DMux8Way { IN  in, sel[3]; OUT a, b, c, d, e, f, g, h; BUILTIN DMux8Way; }",gate:S.DMux8Way},Or8Way:{hdl:"CHIP Or8Way { IN  in[8]; OUT out; BUILTIN Or8Way; }",gate:S.Or8Way},HalfAdder:{hdl:"CHIP HalfAdder { IN  a, b; OUT sum, carry; BUILTIN HalfAdder; }",gate:F.HalfAdder},FullAdder:{hdl:"CHIP FullAdder { IN  a, b, c; OUT sum, carry; BUILTIN FullAdder; }",gate:F.FullAdder},Add16:{hdl:"CHIP Add16 { IN  a[16], b[16]; OUT out[16]; BUILTIN Add16; }",gate:F.Add16},Inc16:{hdl:"CHIP Inc16 { IN  in[16]; OUT out[16]; BUILTIN Inc16; }",gate:F.Inc16},ALU:{hdl:"CHIP ALU { IN x[16], y[16], zx, nx, zy, ny, f, no; OUT out[16], zr, ng; BUILTIN ALU; }",gate:F.ALU},Bit:{hdl:"CHIP Bit { IN  in, load; OUT out; BUILTIN Bit; CLOCKED in, load; }",gate:_.Bit},Register:{hdl:"CHIP Register { IN  in[16], load; OUT out[16]; BUILTIN Register; CLOCKED in, load; }",gate:_.Register},PC:{hdl:"CHIP PC { IN  in[16], load, inc, reset; OUT out[16]; BUILTIN PC; CLOCKED in, load, inc, reset; }",gate:_.PC},RAM8:{hdl:"CHIP RAM8 { IN  in[16], load, address[3]; OUT out[16]; BUILTIN RAM8; CLOCKED in, load; }",gate:_.RAM8},RAM64:{hdl:"CHIP RAM64 { IN in[16], load, address[6]; OUT out[16]; BUILTIN RAM64; CLOCKED in, load; }",gate:_.RAM64},RAM512:{hdl:"CHIP RAM512 { IN  in[16], load, address[9]; OUT out[16]; BUILTIN RAM512; CLOCKED in, load; }",gate:_.RAM512},RAM4K:{hdl:"CHIP RAM4K { IN  in[16], load, address[12]; OUT out[16]; BUILTIN RAM4K; CLOCKED in, load; }",gate:_.RAM4K},RAM16K:{hdl:"CHIP RAM16K { IN  in[16], load, address[14]; OUT out[16]; BUILTIN RAM16K; CLOCKED in, load; }",gate:_.RAM16K},Screen:{hdl:"CHIP Screen { IN in[16], load, address[13]; OUT out[16]; BUILTIN Screen; CLOCKED in, load; }",gate:X.Screen},Keyboard:{hdl:"CHIP Keyboard { OUT out[16]; BUILTIN Keyboard; }",gate:X.Keyboard},ROM32K:{hdl:"CHIP ROM32K { IN  address[15]; OUT out[16]; BUILTIN ROM32K; }",gate:X.ROM32K}},Q=i(10),J=i(6),Z=i(8);var q=function(){function t(){Object(o.a)(this,t),this.value=void 0,this.connections=null,this.value=new Uint16Array(1)}return Object(l.a)(t,[{key:"get",value:function(){return this.value[0]}},{key:"set",value:function(t){var e;if(t!==this.value[0]){this.value[0]=t;var i,n=Object(Z.a)(null!==(e=this.connections)&&void 0!==e?e:[]);try{for(n.s();!(i=n.n()).done;){i.value.set(this.get())}}catch(a){n.e(a)}finally{n.f()}}}},{key:"connect",value:function(t){this.connections||(this.connections=new Set),this.connections.add(t)}},{key:"disconnect",value:function(t){this.connections&&this.connections.delete(t)}}]),t}(),Y=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t){var n,a=Object(c.a)(t,2),s=a[0],r=a[1];return Object(o.a)(this,i),(n=e.call(this)).mask=void 0,n.shiftRight=void 0,n.mask=et(s,r),n.shiftRight=s,n}return Object(l.a)(i,[{key:"set",value:function(t){Object(Q.a)(Object(J.a)(i.prototype),"set",this).call(this,t)}},{key:"get",value:function(){return(this.value[0]&this.mask)>>>this.shiftRight}}]),i}(q),$=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n){var a,s=Object(c.a)(n,2),r=s[0],u=s[1];return Object(o.a)(this,i),(a=e.call(this)).target=void 0,a.mask=void 0,a.shiftLeft=void 0,a.target=t,a.shiftLeft=r,a.mask=et(r,u),a}return Object(l.a)(i,[{key:"get",value:function(){return this.target.get()}},{key:"set",value:function(t){var e=this.target.get()&~this.mask,i=t<<this.shiftLeft&this.mask;this.target.set(e|i)}}]),i}(q),tt=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768];function et(t,e){for(var i=0,n=tt[t],a=t;a<=e;a++)i|=n,n<<=1;return i}var it,nt=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,s){var r;switch(Object(o.a)(this,i),(r=e.call(this,t,a,s)).tsClassName=void 0,n.expectPeek(g.IDENTIFIER,"Missing typescript class name"),t){case"Nand":r.tsClassName=z.Nand.gate;break;case"Not":r.tsClassName=z.Not.gate;break;case"Not16":r.tsClassName=z.Not16.gate;break;case"And":r.tsClassName=z.And.gate;break;case"And16":r.tsClassName=z.And16.gate;break;case"Or":r.tsClassName=z.Or.gate;break;case"Or16":r.tsClassName=z.Or16.gate;break;case"Xor":r.tsClassName=z.Xor.gate;break;case"Mux":r.tsClassName=z.Mux.gate;break;case"Mux16":r.tsClassName=z.Mux16.gate;break;case"Mux4Way16":r.tsClassName=z.Mux4Way16.gate;break;case"Mux8Way16":r.tsClassName=z.Mux8Way16.gate;break;case"DMux":r.tsClassName=z.DMux.gate;break;case"DMux4Way":r.tsClassName=z.DMux4Way.gate;break;case"DMux8Way":r.tsClassName=z.DMux8Way.gate;break;case"Or8Way":r.tsClassName=z.Or8Way.gate;break;case"HalfAdder":r.tsClassName=z.HalfAdder.gate;break;case"FullAdder":r.tsClassName=z.FullAdder.gate;break;case"Add16":r.tsClassName=z.Add16.gate;break;case"Inc16":r.tsClassName=z.Inc16.gate;break;case"ALU":r.tsClassName=z.ALU.gate;break;case"DFF":r.tsClassName=z.DFF.gate;break;case"Bit":r.tsClassName=z.Bit.gate;break;case"Register":r.tsClassName=z.Register.gate;break;case"PC":r.tsClassName=z.PC.gate;break;case"RAM8":r.tsClassName=z.RAM8.gate;break;case"RAM64":r.tsClassName=z.RAM64.gate;break;case"RAM512":r.tsClassName=z.RAM512.gate;break;case"RAM4K":r.tsClassName=z.RAM4K.gate;break;case"RAM16K":r.tsClassName=z.RAM16K.gate;break;case"Screen":r.tsClassName=z.Screen.gate;break;case"Keyboard":r.tsClassName=z.Keyboard.gate;break;case"ROM32K":r.tsClassName=z.ROM32K.gate;break;default:n.fail("Unexpected gate class name ".concat(t))}if(n.expectPeek(g.SEMICOLON,"Missing ';'"),r.isInputClocked=new Array(a.length),r.isOutputClocked=new Array(s.length),n.peekTokenIs(g.CLOCKED)){r.isClocked=!0;for(var u=ct(n),c=0;c<u.length;c++){for(var l=!1,h=!1,d=0;d<r.isInputClocked.length&&!l;d++)r.isInputClocked[d]||(l=a[d].name===u[c].name,r.isInputClocked[d]=l);if(!l)for(var p=0;p<r.isOutputClocked.length&&!h;p++)r.isOutputClocked[p]||(h=s[p].name===u[p].name,r.isOutputClocked[p]=h)}}return n.expectPeek(g.RBRACE,"Missing '}'"),r}return Object(l.a)(i,[{key:"newInstance",value:function(){var t=this.inputPinsInfo.map((function(t){return new q})),e=this.outputPinsInfo.map((function(t){return new q}));return new this.tsClassName(t,e,this)}}]),i}(h);!function(t){t.FROM_INPUT="FROM_INPUT",t.TO_OUTPUT="TO_OUTPUT",t.FROM_INTERNAL="FROM_INTERNAL",t.TO_INTERNAL="TO_INTERNAL",t.FROM_TRUE="FROM_TRUE",t.FROM_FALSE="FROM_FALSE",t.INVALID="INVALID"}(it||(it={}));var at=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,s,r){var u;return Object(o.a)(this,i),(u=e.call(this,t,n,s)).parts=void 0,u.internalPins=void 0,u.internalPins=a,u.parts=r,u}return Object(l.a)(i,[{key:"reCompute",value:function(){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.eval()}}catch(i){e.e(i)}finally{e.f()}}},{key:"clockUp",value:function(){if(this.gateClass.isClocked){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.tick()}}catch(i){e.e(i)}finally{e.f()}}}},{key:"clockDown",value:function(){if(this.gateClass.isClocked){var t,e=Object(Z.a)(this.parts);try{for(e.s();!(t=e.n()).done;){t.value.tock()}}catch(i){e.e(i)}finally{e.f()}}}},{key:"getNode",value:function(t){var e=Object(Q.a)(Object(J.a)(i.prototype),"getNode",this).call(this,t);if(!e){var a=this.gateClass.getPinType(t),s=this.gateClass.getPinNumber(t);if(a===n.INTERNAL)return this.internalPins[s]}return e}}]),i}(U),st=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(t,n,a,s,r){var u;return Object(o.a)(this,i),(u=e.call(this,t,a,s)).partsList=void 0,u.internalPinsInfo=void 0,u.connections=void 0,u.partsList=[],u.internalPinsInfo=[],u.connections=new Set,u.readParts(n,r),u}return Object(l.a)(i,[{key:"newInstance",value:function(){var t,e,i=this.partsList.map((function(t){return t.newInstance()})),n=this.inputPinsInfo.map((function(t){return new q})),a=this.outputPinsInfo.map((function(t){return new q})),s=this.internalPinsInfo.map((function(t){return new q})),r=new Set,u=null,c=null,o=null,l=Object(Z.a)(this.connections);try{for(l.s();!(t=l.n()).done;){var h=t.value;if(u=i[h.partNumber].getNode(h.partPinName))switch(c=h.gateSubBus,o=h.partSubBus,h.type){case it.FROM_INPUT:this.connectGateToPart(n[h.gatePinNumber],c,u,o);break;case it.TO_OUTPUT:this.connectGateToPart(u,o,a[h.gatePinNumber],c);break;case it.TO_INTERNAL:var d=null===o?new q:new Y(o);u.connect(d),s[h.gatePinNumber]=d;break;case it.FROM_INTERNAL:case it.FROM_TRUE:case it.FROM_FALSE:r.add(h)}}}catch(b){l.e(b)}finally{l.f()}var p,v=Object(Z.a)(r);try{for(v.s();!(p=v.n()).done;){var f=p.value;if(u=i[f.partNumber].getNode(f.partPinName))switch(c=f.gateSubBus,o=f.partSubBus,f.type){case it.FROM_INTERNAL:var O=s[f.gatePinNumber];if(o){var k=new $(u,o);O.connect(k)}else O.connect(u);break;case it.FROM_TRUE:if(c||E.fail("gateSubBus is null"),(e=new Y(c)).set(1),o)new $(u,o).set(e.get());else u.set(e.get());break;case it.FROM_FALSE:if(c||E.fail("gateSubBus is null"),(e=new Y(c)).set(0),o)new $(u,o).set(e.get());else u.set(e.get())}}}catch(b){v.e(b)}finally{v.f()}return new at(n,a,s,this,i)}},{key:"connectGateToPart",value:function(t,e,i,n){var a=i;if(n&&(a=new $(a,n)),e){var s=new Y(e);t.connect(s),s.connect(a)}else t.connect(a)}},{key:"readParts",value:function(t,e){for(var i=!1;t.hasMoreTokens()&&!i;)if(t.peekTokenIs(g.RBRACE))t.advance(),i=!0;else{var n;t.expectPeek(g.IDENTIFIER,"A GateClass name is expected");var a=null!==(n=t.token.literal)&&void 0!==n?n:"",s=rt(a,e),r=this.partsList.length;this.partsList.push(s),this.isClocked=this.isClocked||s.isClocked,t.expectPeek(g.LPAREN,"Missing '('"),this.readPinNames(t,a,r),t.expectPeek(g.SEMICOLON,"Missing ';'")}i||t.fail("Missing '}'"),t.expectPeek(g.EOF,"Expected EOF after '}'")}},{key:"readSubBus",value:function(t){var e;t.expectPeek(g.INT,"Missing bus");var i,n=parseInt(null!==(e=t.token.literal)&&void 0!==e?e:""),a=n;t.peekTokenIs(g.DOT)&&(t.advance(),t.expectPeek(g.DOT,"Expected '..'"),t.expectPeek(g.INT,"Expected high sub bus"),a=parseInt(null!==(i=t.token.literal)&&void 0!==i?i:""));return[n,a]}},{key:"readPinNames",value:function(t,e,i){for(var n=!1;t.hasMoreTokens()&&!n;){var a,s;t.expectPeek(g.IDENTIFIER,"A pin name is expected");var r=null!==(a=t.token.literal)&&void 0!==a?a:"",u=null;t.peekTokenIs(g.LBRACKET)&&(t.advance(),u=this.readSubBus(t),t.expectPeek(g.RBRACKET,"Missing ']'")),t.expectPeek(g.EQUAL,"Missing '='");var c=[g.IDENTIFIER,g.TRUE,g.FALSE];t.expectPeekOneOf(c,"A pin name, true, or false is expected");var o=null!==(s=t.token.literal)&&void 0!==s?s:"",l=null;t.peekTokenIs(g.LBRACKET)&&(t.advance(),l=this.readSubBus(t),t.expectPeek(g.RBRACKET,"Missing ']'")),this.addConnection(t,e,i,r,o,l,u),t.peekTokenIs(g.RPAREN)?n=!0:t.peekTokenIs(g.COMMA)||t.fail("Missing ',' or ')'"),t.advance()}n||t.fail("Unexpected EOF")}},{key:"getPinInfo",value:function(t,e){return t===n.INTERNAL&&e<this.internalPinsInfo.length?this.internalPinsInfo[e]:Object(Q.a)(Object(J.a)(i.prototype),"getPinInfo",this).call(this,t,e)}},{key:"addConnection",value:function(t,e,i,a,s,r,u){var c,o,l,h=this.partsList[i],d=h.getPinType(a);d===n.UNKNOWN&&t.fail("".concat(a," is not a pin in ").concat(e));var p,v=h.getPinNumber(a),f=h.getPinInfo(d,v),O=null!==(c=u?u[1]-u[0]+1:null===f||void 0===f?void 0:f.width)&&void 0!==c?c:0,k=n.UNKNOWN,b=0,I=!1,m=it.INVALID;s===g.TRUE||s===g.FALSE?(p={name:s,width:16},m=it.FROM_TRUE,I=!0):(k=this.getPinType(s))===n.UNKNOWN?(k=n.INTERNAL,p={name:s,width:O},b=this.internalPinsInfo.length,this.internalPinsInfo.push(p),this.registerPin(p,n.INTERNAL,b)):(b=this.getPinNumber(s),p=this.getPinInfo(k,b));var P=null!==(o=r?r[1]-r[0]+1:null===(l=p)||void 0===l?void 0:l.width)&&void 0!==o?o:1;switch(I&&(r=[0,(P=O)-1]),O!==P&&t.fail("".concat(a,"(").concat(O,") and ").concat(s,"(").concat(P,") have different bus widths")),d){case n.INPUT:switch(k){case n.INPUT:m=it.FROM_INPUT;break;case n.INTERNAL:m=it.FROM_INTERNAL;break;case n.OUTPUT:t.fail("Can't connect gate's output pin to part")}break;case n.OUTPUT:switch(k){case n.OUTPUT:m=it.TO_OUTPUT;break;case n.INTERNAL:m=it.TO_INTERNAL;break;case n.INPUT:t.fail("Can't connect part's output pin to gate's input pin")}}this.connections.add({type:m,gatePinNumber:b,partNumber:i,partPinName:a,gateSubBus:r,partSubBus:u})}}]),i}(h);function rt(t,e){var i,n="".concat(t,".hdl");return e.has(n)?ut(null!==(i=e.get(n))&&void 0!==i?i:"",e):function(t,e){var i;switch(t){case"Nand":i=z.Nand.hdl;break;case"Not":i=z.Not.hdl;break;case"Not16":i=z.Not16.hdl;break;case"And":i=z.And.hdl;break;case"And16":i=z.And16.hdl;break;case"Or":i=z.Or.hdl;break;case"Or16":i=z.Or16.hdl;break;case"Xor":i=z.Xor.hdl;break;case"Mux":i=z.Mux.hdl;break;case"Mux16":i=z.Mux16.hdl;break;case"Mux4Way16":i=z.Mux4Way16.hdl;break;case"Mux8Way16":i=z.Mux8Way16.hdl;break;case"DMux":i=z.DMux.hdl;break;case"DMux4Way":i=z.DMux4Way.hdl;break;case"DMux8Way":i=z.DMux8Way.hdl;break;case"Or8Way":i=z.Or8Way.hdl;break;case"HalfAdder":i=z.HalfAdder.hdl;break;case"FullAdder":i=z.FullAdder.hdl;break;case"Add16":i=z.Add16.hdl;break;case"Inc16":i=z.Inc16.hdl;break;case"ALU":i=z.ALU.hdl;break;case"DFF":i=z.DFF.hdl;break;case"Bit":i=z.Bit.hdl;break;case"Register":i=z.Register.hdl;break;case"PC":i=z.PC.hdl;break;case"RAM8":i=z.RAM8.hdl;break;case"RAM64":i=z.RAM64.hdl;break;case"RAM512":i=z.RAM512.hdl;break;case"RAM4K":i=z.RAM4K.hdl;break;case"RAM16K":i=z.RAM16K.hdl;break;case"Screen":i=z.Screen.hdl;break;case"Keyboard":i=z.Keyboard.hdl;break;case"ROM32K":i=z.ROM32K.hdl;break;default:E.fail("Invalid builtin gate class name: ".concat(t))}return ut(i,e)}(t,e)}function ut(t,e){var i=new y(t);return function(t,e){var i;t.expectCurrent(g.CHIP,"Missing 'CHIP' keyword"),t.expectPeek(g.IDENTIFIER,"Missing chip name");var n=null!==(i=t.token.literal)&&void 0!==i?i:"";t.expectPeek(g.LBRACE,"Missing '{'");var a=t.peekTokenIs(g.IN)?ct(t):[],s=t.peekTokenIs(g.OUT)?ct(t):[];return t.advance(),t.tokenIs(g.BUILTIN)?new nt(n,t,a,s):t.tokenIs(g.PARTS)?(t.expectPeek(g.COLON,"Missing ':'"),new st(n,t,a,s,e)):t.fail("'PARTS' or 'BUILTIN' keyword expected")}(new E(i),e)}function ct(t){var e=[],i=!1;for(t.advance();t.hasMoreTokens()&&!i;)if(t.tokenIs(g.SEMICOLON))i=!0;else{var n;t.expectPeek(g.IDENTIFIER,"Missing pin name, found ".concat(t.peek.literal));var a,s=null!==(n=t.token.literal)&&void 0!==n?n:"",r=1;if(t.peekTokenIs(g.LBRACKET))t.advance(),t.expectPeek(g.INT,"Missing width"),r=parseInt(null!==(a=t.token.literal)&&void 0!==a?a:""),t.expectPeek(g.RBRACKET,"Missing ']'");e.push({name:s,width:r}),t.expectPeekOneOf([g.COMMA,g.SEMICOLON],"Missing ',' or ';'")}return i||t.fail("Unexpected EOF"),e}var ot,lt=function(){function t(e){Object(o.a)(this,t),this.gate=void 0,this.clockUp=void 0,this.time=void 0,this.userWorkspace=void 0,this.setGateFilename=void 0,this.setGateFilename=e,this.gate=null,this.clockUp=!1,this.time=0,this.userWorkspace=null}return Object(l.a)(t,[{key:"loadGate",value:function(t,e){this.gate=rt(t,e).newInstance(),this.userWorkspace=e}},{key:"step",value:function(){this.clockUp?this.performTock():this.performTick()}},{key:"performTock",value:function(){null!==this.gate&&(this.gate.tock(),this.clockUp=!1,this.time++)}},{key:"performTick",value:function(){null!==this.gate&&(this.gate.tick(),this.clockUp=!0)}},{key:"performEval",value:function(){null!==this.gate&&this.gate.eval()}},{key:"setInputPin",value:function(t,e){var i;null===(i=this.gate)||void 0===i||i.inputPins[t].set(e)}},{key:"getValue",value:function(t){if("time"===t)return this.time.toString()+(this.clockUp?"+":" ");var e,i=null===(e=this.gate)||void 0===e?void 0:e.getNode(t);if(i)return i.get().toString();throw new Error("incomplete getValue ".concat(t))}},{key:"setValue",value:function(t,e){if(null===this.gate)throw new Error("");var i=function(t){var e=t,i=10;e.startsWith("%B")&&(e=e.substring(2),i=2);return parseInt(e,i).toString()}(e),n=parseInt(i),a=this.gate.getNode(t);a&&a.set(n)}},{key:"doCommand",value:function(t){if(0!==t.length){var e=t[0];if("tick"===e)this.performTick();else if("tock"===e)this.performTock();else if("load"===e){if(!this.userWorkspace)return;this.loadGate(t[1].slice(0,-4),this.userWorkspace),this.setGateFilename(t[1])}else"set"===e?this.setValue(t[1],t[2]):"eval"===e&&this.performEval()}}}]),t}();function ht(t){var e=t.script,i=t.currentLine,n=(null!==e&&void 0!==e?e:"").split("\n");return Object(f.jsx)("div",{className:"testScript",children:n.map((function(t,e){var n="testLine ".concat(e-1===i?"highlight":"");return Object(f.jsx)("pre",{className:n,children:t},e)}))})}!function(t){t.IDENTIFIER="IDENTIFIER",t.INT="INT",t.EOF="EOF",t.REPEAT="REPEAT",t.OUTPUT_FILE="OUTPUT-FILE",t.COMPARE_TO="COMPARE-TO",t.OUTPUT_LIST="OUTPUT-LIST",t.OUTPUT="OUTPUT",t.SEMICOLON="SEMICOLON",t.COMMA="COMMA",t.LBRACE="{",t.RBRACE="}",t.INVALID="INVALID"}(ot||(ot={}));var dt=function(t){Object(P.a)(i,t);var e=Object(T.a)(i);function i(){return Object(o.a)(this,i),e.apply(this,arguments)}return i}(Object(N.a)(Error)),pt=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.readpos=void 0,this.pos=void 0,this.cur=void 0,this.keywords=void 0,this.token={type:null,literal:null},this.lineNumber=void 0,this.input=e,this.readpos=0,this.pos=0,this.cur="",this.keywords={repeat:ot.REPEAT,"output-file":ot.OUTPUT_FILE,"compare-to":ot.COMPARE_TO,"output-list":ot.OUTPUT_LIST,output:ot.OUTPUT},this.lineNumber=0,this.readChar()}return Object(l.a)(t,[{key:"hasMoreTokens",value:function(){return this.token.type!==ot.EOF}},{key:"advance",value:function(){switch(this.skipWhitespaceAndComments(),this.token.literal=this.cur,this.cur){case";":this.token.type=ot.SEMICOLON;break;case",":this.token.type=ot.COMMA;break;case"{":this.token.type=ot.LBRACE;break;case"}":this.token.type=ot.RBRACE;break;case"":this.token.type=ot.EOF;break;default:if(vt(this.cur)){var t=this.readIdentifier();return this.token.type=this.lookupIdentifier(t),void(this.token.literal=t)}if(ft(this.cur))return this.token.type=ot.INT,void(this.token.literal=this.readNumber())}this.readChar()}},{key:"fail",value:function(e){t.fail(e)}},{key:"lookupIdentifier",value:function(t){var e;return null!==(e=this.keywords[t])&&void 0!==e?e:ot.IDENTIFIER}},{key:"readIdentifier",value:function(){for(var t=this.pos;vt(this.cur)||ft(this.cur)||"-"===this.cur||"."===this.cur;)this.readChar();return this.input.substring(t,this.pos)}},{key:"readNumber",value:function(){for(var t=this.pos;ft(this.cur);)this.readChar();return this.input.substring(t,this.pos)}},{key:"readChar",value:function(){this.cur=this.readpos>=this.input.length?"":this.input[this.readpos],this.pos=this.readpos,this.readpos++}},{key:"peekChar",value:function(){return this.readpos>=this.input.length?"":this.input[this.readpos]}},{key:"skipWhitespaceAndComments",value:function(){for(var t=!1,e=!1;;){var i=this.peekChar();if("\n"===this.cur&&this.lineNumber++,"/"===this.cur&&"/"===i)t=!0,this.readChar();else if(t&&"\n"===this.cur)t=!1;else if("/"===this.cur&&"*"===i)e=!0,this.readChar();else if(e&&"*"===this.cur&&"/"===i)e=!1,this.readChar();else if(!t&&!e&&" "!==this.cur&&"\t"!==this.cur&&"\n"!==this.cur&&"\r"!==this.cur)return;this.readChar()}}}],[{key:"fail",value:function(t){throw new dt(t)}}]),t}();function vt(t){var e=t.charCodeAt(0);return e>=65&&e<91||e>=97&&e<123||"%"===t}function ft(t){var e=t.charCodeAt(0);return e>=48&&e<58}var Ot,kt,bt=function t(e,i,n,a,s){Object(o.a)(this,t),this.varName=void 0,this.format=void 0,this.padL=void 0,this.padR=void 0,this.len=void 0,this.varName=e,this.format=i,this.padL=n,this.padR=a,this.len=s};!function(t){t[t.END=0]="END",t[t.SIMULATOR=1]="SIMULATOR",t[t.REPEAT=2]="REPEAT",t[t.REPEAT_END=3]="REPEAT_END",t[t.OUTPUT_FILE=4]="OUTPUT_FILE",t[t.COMPARE_TO=5]="COMPARE_TO",t[t.OUTPUT_LIST=6]="OUTPUT_LIST",t[t.OUTPUT=7]="OUTPUT"}(Ot||(Ot={})),function(t){t[t.SINGLE_STEP=0]="SINGLE_STEP",t[t.MINI_STEP=1]="MINI_STEP"}(kt||(kt={}));var It=function(){function t(e,i){Object(o.a)(this,t),this.code=void 0,this.args=void 0,this.terminator=void 0,this.code=e,this.args=i}return Object(l.a)(t,[{key:"getArg",value:function(){return this.args}},{key:"setTerminator",value:function(t){this.terminator=t}}]),t}(),gt=function(){function t(e){Object(o.a)(this,t),this.input=void 0,this.commands=void 0,this.lineNumbers=void 0,this.input=new pt(e),this.commands=[],this.lineNumbers=[],this.buildScript()}return Object(l.a)(t,[{key:"getCommandAt",value:function(t){return this.commands[t]}},{key:"readArgs",value:function(t){for(var e=new Array(t),i=0;this.input.hasMoreTokens()&&this.input.token.type!==ot.SEMICOLON&&this.input.token.type!==ot.COMMA&&i<t;){var n;e[i]=null!==(n=this.input.token.literal)&&void 0!==n?n:"",this.input.advance(),i++}return e}},{key:"buildScript",value:function(){for(var t=null,e=!1,i=0;this.input.hasMoreTokens();){switch(i=this.input.lineNumber-1,this.input.advance(),this.input.token.type){case ot.REPEAT:t=this.createRepeatCommand(),e=!0;break;case ot.OUTPUT_FILE:t=this.createOutputFileCommand();break;case ot.COMPARE_TO:t=this.createCompareToCommand();break;case ot.OUTPUT_LIST:t=this.createOutputListCommand();break;case ot.OUTPUT:t=this.createOutputCommand();break;case ot.IDENTIFIER:var n=this.readArgs(4);t=new It(Ot.SIMULATOR,n);break;case ot.RBRACE:e&&(t=new It(Ot.REPEAT_END,[]),e=!1)}if(t)switch(this.commands.push(t),this.lineNumbers.push(i),this.input.token.type){case ot.SEMICOLON:t.terminator=kt.SINGLE_STEP;break;case ot.COMMA:t.terminator=kt.MINI_STEP}t=null}t=new It(Ot.END,[]),this.commands.push(t),this.lineNumbers.push(i)}},{key:"createOutputFileCommand",value:function(){this.input.advance();var t=this.readArgs(1);return new It(Ot.OUTPUT_FILE,t)}},{key:"createOutputCommand",value:function(){return this.input.advance(),new It(Ot.OUTPUT,[])}},{key:"createCompareToCommand",value:function(){this.input.advance();var t=this.readArgs(1);return new It(Ot.COMPARE_TO,t)}},{key:"createOutputListCommand",value:function(){this.input.advance();var t,e=this.readArgs(20);for(t=0;t<e.length&&void 0!==e[t];t++);for(var i=new Array(t),n=0;n<t;n++){var a=e[n].indexOf("%");-1===a&&(a=e[n].length,e[n]+="%B1.1.1");var s=e[n].substring(0,a),r=e[n].charAt(a+1),u=e[n].indexOf(".",a);if(-1===u)throw new Error("Missing '.'");var c=parseInt(e[n].substring(a+2,u)),o=e[n].indexOf(".",u+1);if(-1===o)throw new Error("Missing '.'");var l=parseInt(e[n].substring(u+1,o)),h=parseInt(e[n].substring(o+1));i[n]=new bt(s,r,c,h,l)}return new It(Ot.OUTPUT_LIST,i)}},{key:"createRepeatCommand",value:function(){return this.input.advance(),this.input.token.type!==ot.LBRACE&&this.input.fail("Missing '{' in repeat command"),new It(Ot.REPEAT,[])}}]),t}(),mt=function(){function t(e,i,n){Object(o.a)(this,t),this.simulator=void 0,this.script=void 0,this.currentCommandIndex=void 0,this.loopCommandIndex=void 0,this.varList=void 0,this.output=void 0,this.outputLinesCounter=void 0,this.compare=void 0,this.compareLinesCounter=void 0,this.comparisonFailed=void 0,this.comparisonFailureLine=void 0,this.userWorkspace=void 0,this.displayMessage=void 0,this.setTestScriptLine=void 0,this.simulator=e,this.displayMessage=function(t,e){return i(t)},this.setTestScriptLine=n,this.script=null,this.currentCommandIndex=0,this.loopCommandIndex=0,this.varList=[],this.output="",this.outputLinesCounter=0,this.compare=[],this.compareLinesCounter=0,this.comparisonFailed=!1,this.comparisonFailureLine=0,this.userWorkspace=new Map}return Object(l.a)(t,[{key:"getGate",value:function(){return this.simulator.gate}},{key:"loadGate",value:function(t,e){this.userWorkspace=e,this.simulator.loadGate(t,e)}},{key:"loadScript",value:function(t,e){var i;this.userWorkspace=e;var n=null!==(i=e.get(t))&&void 0!==i?i:"tick; tock;";this.script=new gt(n),this.currentCommandIndex=0,this.setTestScriptLine(this.script.lineNumbers[0]),this.output="",this.compare=[],this.displayMessage("New script loaded "+t,!1)}},{key:"setInputPin",value:function(t,e){this.simulator.setInputPin(t,e)}},{key:"singleStep",value:function(){var t,e,i;do{i=this.miniStep()}while(i===kt.MINI_STEP);this.setTestScriptLine(null!==(t=null===(e=this.script)||void 0===e?void 0:e.lineNumbers[this.currentCommandIndex])&&void 0!==t?t:-1)}},{key:"miniStep",value:function(){var t,e,i,n=!1;do{var a;if(!(i=null===(a=this.script)||void 0===a?void 0:a.getCommandAt(this.currentCommandIndex)))throw new Error("No command found.");switch(n=!1,i.code){case Ot.SIMULATOR:this.simulator.doCommand(i.getArg());break;case Ot.OUTPUT_FILE:this.output="",this.outputLinesCounter=0;break;case Ot.COMPARE_TO:this.compare=null!==(t=null===(e=this.userWorkspace.get(i.getArg()[0]))||void 0===e?void 0:e.split("\n"))&&void 0!==t?t:[],this.compareLinesCounter=0,this.comparisonFailed=!1;break;case Ot.OUTPUT_LIST:this.doOutputListCommand(i);break;case Ot.OUTPUT:this.doOutputCommand(i);break;case Ot.REPEAT:this.loopCommandIndex=this.currentCommandIndex+1,n=!0;break;case Ot.END:this.compare?this.comparisonFailed?this.displayMessage("End of script - Comparison failure at line ".concat(this.comparisonFailureLine),!0):this.displayMessage("End of script - Comparison ended successfully",!1):this.displayMessage("End of script",!1)}if(i.code!==Ot.END){var s;this.currentCommandIndex++,this.setTestScriptLine(this.currentCommandIndex);var r=null===(s=this.script)||void 0===s?void 0:s.getCommandAt(this.currentCommandIndex);(null===r||void 0===r?void 0:r.code)===Ot.REPEAT_END&&(this.currentCommandIndex=this.loopCommandIndex,this.setTestScriptLine(this.currentCommandIndex))}}while(n);if(!i)throw new Error("No command found.");return i.terminator}},{key:"doOutputCommand",value:function(t){for(var e="|",i=0;i<this.varList.length;i++){var n=this.varList[i],a=this.simulator.getValue(n.varName);if("S"!==n.format){var s=parseInt(a);"B"===n.format&&(a=s.toString(2).padStart(16,"0"))}a.length>n.len&&(a=a.substring(a.length-n.len)),e+=" ".repeat(n.padL)+a+" ".repeat(n.padR)+"|"}this.outputAndCompare(e)}},{key:"doOutputListCommand",value:function(t){this.varList=t.getArg();for(var e="|",i=0;i<this.varList.length;i++){var n=this.varList[i],a=n.padL+n.padR+n.len,s=n.varName.length>a?n.varName.substring(0,a):n.varName,r=Math.floor((a-s.length)/2),u=a-r-s.length;e+=" ".repeat(r)+s+" ".repeat(u)+"|"}this.outputAndCompare(e)}},{key:"outputAndCompare",value:function(t){if(this.output+=t+"\n",this.outputLinesCounter++,this.compare.length>0){var e=this.compare[this.compareLinesCounter];this.compareLinesCounter++,this.compareLine(t,e)||(this.comparisonFailed=!0,this.comparisonFailureLine=this.compareLinesCounter,this.displayMessage("Comparison failure at line ".concat(this.comparisonFailureLine),!0))}}},{key:"compareLine",value:function(t,e){return console.log(t,e.trim()),e.trim()===t}}]),t}();function Pt(){var t,e=Object(a.useState)(null),i=Object(c.a)(e,2),s=i[0],r=i[1],u=Object(a.useState)(null),o=Object(c.a)(u,2),l=o[0],h=o[1],d=Object(a.useState)("default.tst"),p=Object(c.a)(d,2),v=p[0],g=p[1],m=Object(a.useState)(null),P=Object(c.a)(m,2),T=P[0],N=P[1],C=Object(a.useState)({input:[],output:[],internal:[]}),y=Object(c.a)(C,2),j=y[0],A=y[1],E=Object(a.useState)(null),U=Object(c.a)(E,2),M=U[0],R=U[1],L=Object(a.useState)("decimal"),x=Object(c.a)(L,2),w=x[0],S=x[1],F=Object(a.useRef)(new mt(new lt(h),R,N)),D=Object(a.useCallback)((function(){var t=F.current.getGate();if(!t)throw new Error("updatePinData: gate can not be null");var e=Tt(t,n.INPUT),i=Tt(t,n.OUTPUT),a=Tt(t,n.INTERNAL);A({input:e,output:i,internal:a})}),[]);Object(a.useEffect)((function(){if(l&&s&&l.endsWith(".hdl")){var t=l.slice(0,-4);try{F.current.loadGate(t,s),D(),R("Loaded successfully!")}catch(e){R("".concat(e))}}}),[l,s,D]),Object(a.useEffect)((function(){v&&s&&F.current.loadScript(v,s)}),[v,s]);var B,W=Object(a.useCallback)((function(){F.current.singleStep(),D()}),[D]),K=Object(a.useCallback)((function(t){var e=t.value,i=t.number;t.type===n.INPUT&&(F.current.setInputPin(i,parseInt(e)||0),D())}),[D]),_="No hdl file";s&&l&&(_=null!==(B=s.get(l))&&void 0!==B?B:"");null===s||void 0===s||s.set("default.tst","repeat {\n    tick,\n    tock;\n}");var H=null!==(t=v?null===s||void 0===s?void 0:s.get(v):null)&&void 0!==t?t:"No test found";return Object(f.jsxs)("div",{id:"hardwareSimulator",children:[Object(f.jsx)("div",{className:"header",children:Object(f.jsx)("h1",{children:"HardwareSimulator"})}),Object(f.jsx)(O,{hdlFilename:l,setHDLFileName:h,userWorkspace:s,setUserWorkspace:r,testScript:v,setTestScript:g,setFormat:S,singleStep:W}),Object(f.jsxs)("div",{className:"container",children:[Object(f.jsx)(b,{title:"Input Pins",type:n.INPUT,pinData:j.input,updatePin:K,format:w}),Object(f.jsx)(b,{title:"Output Pins",type:n.OUTPUT,pinData:j.output,updatePin:K,format:w}),Object(f.jsx)(k,{hdl:_}),Object(f.jsx)(b,{title:"Internal Pins",type:n.INTERNAL,pinData:j.internal,updatePin:K,format:w}),Object(f.jsx)(ht,{script:H,currentLine:T})]}),Object(f.jsx)(I,{status:M})]})}function Tt(t,e){var i=[];switch(e){case n.INPUT:return i=t.gateClass.inputPinsInfo,t.inputPins.map((function(t,e){return{name:i[e].name,value:t.value[0].toString()}}));case n.OUTPUT:return i=t.gateClass.outputPinsInfo,t.outputPins.map((function(t,e){return{name:i[e].name,value:t.value[0].toString()}}));case n.INTERNAL:var a=t;if(!a)return[];var s=a.gateClass;return s?(i=s.internalPinsInfo,a.internalPins.map((function(t,e){return{name:i[e].name,value:t.value[0].toString()}}))):[];default:throw new Error("pinType is ".concat(e))}}function Nt(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(Pt,{})})}var Ct=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,28)).then((function(e){var i=e.getCLS,n=e.getFID,a=e.getFCP,s=e.getLCP,r=e.getTTFB;i(t),n(t),a(t),s(t),r(t)}))};u.a.render(Object(f.jsx)(s.a.StrictMode,{children:Object(f.jsx)(Nt,{})}),document.getElementById("root")),Ct()}},[[27,1,2]]]);
//# sourceMappingURL=main.b526cfc1.chunk.js.map